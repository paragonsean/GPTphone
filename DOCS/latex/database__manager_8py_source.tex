\doxysection{database\+\_\+manager.\+py}
\hypertarget{database__manager_8py_source}{}\label{database__manager_8py_source}\index{/Users/seanbaker/Downloads/GPTPhone (2)/DataLibrary/database\_manager.py@{/Users/seanbaker/Downloads/GPTPhone (2)/DataLibrary/database\_manager.py}}
\mbox{\hyperlink{database__manager_8py}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00001}\mbox{\hyperlink{namespacedatabase__manager}{00001}}\ \textcolor{keyword}{import}\ os}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00002}00002\ \textcolor{keyword}{from}\ typing\ \textcolor{keyword}{import}\ List,\ Optional}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00003}00003\ \textcolor{keyword}{from}\ datetime\ \textcolor{keyword}{import}\ datetime}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00004}00004\ \textcolor{keyword}{from}\ sqlalchemy.ext.asyncio\ \textcolor{keyword}{import}\ create\_async\_engine,\ AsyncSession}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00005}00005\ \textcolor{keyword}{from}\ sqlalchemy\ \textcolor{keyword}{import}\ Column,\ String,\ Boolean,\ Text,\ DateTime,\ Integer,\ ForeignKey}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00006}00006\ \textcolor{keyword}{from}\ sqlalchemy.ext.declarative\ \textcolor{keyword}{import}\ declarative\_base}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00007}00007\ \textcolor{keyword}{from}\ sqlalchemy.orm\ \textcolor{keyword}{import}\ sessionmaker,\ relationship}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00008}00008\ \textcolor{keyword}{import}\ json}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00009}00009\ }
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00010}00010\ }
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00011}\mbox{\hyperlink{classdatabase__manager_1_1_database_manager}{00011}}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdatabase__manager_1_1_database_manager}{DatabaseManager}}:}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00012}00012\ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00013}00013\ \textcolor{stringliteral}{\ \ \ \ DatabaseManager\ is\ a\ class\ that\ manages\ the\ database\ operations\ for\ call\ contexts\ and\ transcriptions.}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00014}00014\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00015}00015\ \textcolor{stringliteral}{\ \ \ \ Args:}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00016}00016\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ db\_url\ (str):\ The\ URL\ of\ the\ database.\ Default\ is\ "{}sqlite+aiosqlite:///./DataLibrary/call\_contexts.db"{}.}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00017}00017\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00018}00018\ \textcolor{stringliteral}{\ \ \ \ Attributes:}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00019}00019\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ engine\ (alchemy.AsyncEngine):\ The\ SQLAlchemy\ async\ engine\ for\ the\ database\ connection.}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00020}00020\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ SessionLocal\ (alchemy.orm.session.Session):\ The\ SQLAlchemy\ async\ session\ for\ the\ database.}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00021}00021\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Base\ (alchemy.ext.declarative.api.DeclarativeMeta):\ The\ SQLAlchemy\ declarative\ base\ for\ table\ definitions.}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00022}00022\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ ContactModel\ (alchemy.ext.declarative.api.DeclarativeMeta):\ The\ SQLAlchemy\ model\ class\ for\ contacts\ table.}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00023}00023\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ CallContextModel\ (alchemy.ext.declarative.api.DeclarativeMeta):\ The\ SQLAlchemy\ model\ class\ for\ call\_contexts\ table.}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00024}00024\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ TranscriptionModel\ (alchemy.ext.declarative.api.DeclarativeMeta):\ The\ SQLAlchemy\ model\ class\ for\ transcriptions\ table.}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00025}00025\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00026}00026\ \textcolor{stringliteral}{\ \ \ \ Methods:}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00027}00027\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ \_initialize\_tables():\ Initializes\ the\ tables\ in\ the\ database.}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00028}00028\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ get\_db():\ Creates\ a\ database\ session\ and\ yields\ it\ for\ use.}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00029}00029\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ create\_call\_context(db:\ AsyncSession,\ call\_context):\ Creates\ a\ new\ call\ context\ in\ the\ database.}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00030}00030\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ get\_call\_context(db:\ AsyncSession,\ call\_sid:\ str):\ Retrieves\ a\ call\ context\ based\ on\ the\ call\ SID.}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00031}00031\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ update\_call\_context(db:\ AsyncSession,\ call\_sid:\ str,\ call\_context):\ Updates\ a\ call\ context\ in\ the\ database.}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00032}00032\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ delete\_call\_context(db:\ AsyncSession,\ call\_sid:\ str):\ Deletes\ a\ call\ context\ from\ the\ database.}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00033}00033\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ get\_all\_call\_contexts(db:\ AsyncSession):\ Retrieves\ all\ call\ contexts\ from\ the\ database.}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00034}00034\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ create\_transcription(db:\ AsyncSession,\ call\_sid:\ str,\ transcription\_text:\ str):\ Creates\ a\ new\ transcription\ in\ the\ database.}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00035}00035\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ get\_transcription(db:\ AsyncSession,\ call\_sid:\ str):\ Retrieves\ a\ transcription\ based\ on\ the\ call\ SID.}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00036}00036\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ delete\_transcription(db:\ AsyncSession,\ call\_sid:\ str):\ Deletes\ a\ transcription\ from\ the\ database.}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00037}00037\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ get\_all\_contacts(db:\ AsyncSession):\ Retrieves\ all\ contacts\ from\ the\ database.}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00038}00038\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ get\_contact\_by\_phone(db:\ AsyncSession,\ phone\_number:\ str):\ Retrieves\ a\ contact\ based\ on\ the\ phone\ number.}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00039}00039\ \textcolor{stringliteral}{\ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00040}\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_aab3c0693a9325f959d9e37f75482c843}{00040}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_aab3c0693a9325f959d9e37f75482c843}{\_\_init\_\_}}(self,\ db\_url:\ str\ =\ \textcolor{stringliteral}{"{}sqlite+aiosqlite:///./DataLibrary/call\_contexts.db"{}}):}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00041}00041\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Ensure\ the\ DataLibrary\ folder\ exists}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00042}00042\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ \textcolor{keywordflow}{not}\ os.path.exists(\textcolor{stringliteral}{'DataLibrary'}):}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00043}00043\ \ \ \ \ \ \ \ \ \ \ \ \ os.makedirs(\textcolor{stringliteral}{'DataLibrary'})}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00044}00044\ }
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00045}00045\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ SQLAlchemy\ async\ setup\ with\ aiosqlite}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00046}\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_aa0e496074df89ca930fe1c2081c58eed}{00046}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_aa0e496074df89ca930fe1c2081c58eed}{engine}}\ =\ create\_async\_engine(db\_url,\ connect\_args=\{\textcolor{stringliteral}{"{}check\_same\_thread"{}}:\ \textcolor{keyword}{False}\})}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00047}\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_ac1e3119ff7a8c0e5a0ed618ec7fff11a}{00047}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_ac1e3119ff7a8c0e5a0ed618ec7fff11a}{SessionLocal}}\ =\ sessionmaker(autocommit=\textcolor{keyword}{False},\ autoflush=\textcolor{keyword}{False},\ bind=self.\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_aa0e496074df89ca930fe1c2081c58eed}{engine}},\ class\_=AsyncSession)}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00048}\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a81dafa727c1f3a38ae0f77c73c6d2d69}{00048}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a81dafa727c1f3a38ae0f77c73c6d2d69}{Base}}\ =\ declarative\_base()}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00049}00049\ }
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00050}00050\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Initialize\ the\ tables}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00051}00051\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a53be215da730633d5369fad9677cd523}{\_initialize\_tables}}()}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00052}00052\ }
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00053}\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a53be215da730633d5369fad9677cd523}{00053}}\ \ \ \ \ \textcolor{keyword}{def\ }\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a53be215da730633d5369fad9677cd523}{\_initialize\_tables}}(self):}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00054}00054\ \ \ \ \ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_aca6cf2c61b69b0c1b7852660d101cd92}{ContactModel}}(self.Base):}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00055}00055\ \ \ \ \ \ \ \ \ \ \ \ \ \_\_tablename\_\_\ =\ \textcolor{stringliteral}{"{}contacts"{}}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00056}00056\ }
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00057}00057\ \ \ \ \ \ \ \ \ \ \ \ \ contact\_id\ =\ Column(Integer,\ primary\_key=\textcolor{keyword}{True},\ index=\textcolor{keyword}{True})}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00058}00058\ \ \ \ \ \ \ \ \ \ \ \ \ phone\_number\ =\ Column(String,\ unique=\textcolor{keyword}{True},\ nullable=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00059}00059\ \ \ \ \ \ \ \ \ \ \ \ \ created\_at\ =\ Column(DateTime,\ default=datetime.utcnow)}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00060}00060\ }
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00061}00061\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Relationship\ to\ Calls}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00062}00062\ \ \ \ \ \ \ \ \ \ \ \ \ calls\ =\ relationship(\textcolor{stringliteral}{"{}CallContextModel"{}},\ back\_populates=\textcolor{stringliteral}{"{}contact"{}})}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00063}00063\ }
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00064}00064\ \ \ \ \ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a1c77872953fb5b143be1c3c81cb28df0}{CallContextModel}}(self.Base):}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00065}00065\ \ \ \ \ \ \ \ \ \ \ \ \ \_\_tablename\_\_\ =\ \textcolor{stringliteral}{"{}call\_contexts"{}}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00066}00066\ }
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00067}00067\ \ \ \ \ \ \ \ \ \ \ \ \ call\_sid\ =\ Column(String,\ primary\_key=\textcolor{keyword}{True},\ index=\textcolor{keyword}{True})}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00068}00068\ \ \ \ \ \ \ \ \ \ \ \ \ stream\_sid\ =\ Column(String,\ index=\textcolor{keyword}{True})}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00069}00069\ \ \ \ \ \ \ \ \ \ \ \ \ call\_ended\ =\ Column(Boolean,\ default=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00070}00070\ \ \ \ \ \ \ \ \ \ \ \ \ user\_context\ =\ Column(Text)}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00071}00071\ \ \ \ \ \ \ \ \ \ \ \ \ system\_message\ =\ Column(String)}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00072}00072\ \ \ \ \ \ \ \ \ \ \ \ \ initial\_message\ =\ Column(String)}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00073}00073\ \ \ \ \ \ \ \ \ \ \ \ \ start\_time\ =\ Column(DateTime,\ default=datetime.utcnow)}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00074}00074\ \ \ \ \ \ \ \ \ \ \ \ \ end\_time\ =\ Column(DateTime)}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00075}00075\ \ \ \ \ \ \ \ \ \ \ \ \ final\_status\ =\ Column(String)}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00076}00076\ \ \ \ \ \ \ \ \ \ \ \ \ to\_number\ =\ Column(String,\ nullable=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00077}00077\ \ \ \ \ \ \ \ \ \ \ \ \ from\_number\ =\ Column(String,\ nullable=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00078}00078\ }
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00079}00079\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Foreign\ key\ to\ ContactModel}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00080}00080\ \ \ \ \ \ \ \ \ \ \ \ \ contact\_id\ =\ Column(Integer,\ ForeignKey(\textcolor{stringliteral}{'contacts.contact\_id'}))}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00081}00081\ \ \ \ \ \ \ \ \ \ \ \ \ contact\ =\ relationship(\textcolor{stringliteral}{"{}ContactModel"{}},\ back\_populates=\textcolor{stringliteral}{"{}calls"{}})}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00082}00082\ }
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00083}00083\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Relationship\ to\ Transcriptions}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00084}00084\ \ \ \ \ \ \ \ \ \ \ \ \ transcription\ =\ relationship(\textcolor{stringliteral}{"{}TranscriptionModel"{}},\ back\_populates=\textcolor{stringliteral}{"{}call"{}},\ uselist=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00085}00085\ }
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00086}00086\ \ \ \ \ \ \ \ \ \textcolor{keyword}{class\ }\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a941701a4a1ed39cba8424bda78a93dc5}{TranscriptionModel}}(self.Base):}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00087}00087\ \ \ \ \ \ \ \ \ \ \ \ \ \_\_tablename\_\_\ =\ \textcolor{stringliteral}{"{}transcriptions"{}}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00088}00088\ }
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00089}00089\ \ \ \ \ \ \ \ \ \ \ \ \ transcription\_id\ =\ Column(Integer,\ primary\_key=\textcolor{keyword}{True},\ index=\textcolor{keyword}{True})}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00090}00090\ \ \ \ \ \ \ \ \ \ \ \ \ call\_id\ =\ Column(String,\ ForeignKey(\textcolor{stringliteral}{'call\_contexts.call\_sid'}),\ nullable=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00091}00091\ \ \ \ \ \ \ \ \ \ \ \ \ transcription\_text\ =\ Column(Text,\ nullable=\textcolor{keyword}{False})}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00092}00092\ \ \ \ \ \ \ \ \ \ \ \ \ created\_at\ =\ Column(DateTime,\ default=datetime.utcnow)}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00093}00093\ }
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00094}00094\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Relationship\ to\ CallContext}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00095}00095\ \ \ \ \ \ \ \ \ \ \ \ \ call\ =\ relationship(\textcolor{stringliteral}{"{}CallContextModel"{}},\ back\_populates=\textcolor{stringliteral}{"{}transcription"{}})}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00096}00096\ }
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00097}00097\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Save\ these\ classes\ as\ attributes\ of\ the\ DatabaseManager\ class}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00098}\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_aca6cf2c61b69b0c1b7852660d101cd92}{00098}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_aca6cf2c61b69b0c1b7852660d101cd92}{ContactModel}}\ =\ ContactModel}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00099}\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a1c77872953fb5b143be1c3c81cb28df0}{00099}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a1c77872953fb5b143be1c3c81cb28df0}{CallContextModel}}\ =\ CallContextModel}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00100}\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a941701a4a1ed39cba8424bda78a93dc5}{00100}}\ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a941701a4a1ed39cba8424bda78a93dc5}{TranscriptionModel}}\ =\ TranscriptionModel}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00101}00101\ }
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00102}00102\ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Create\ the\ database\ tables}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00103}00103\ \ \ \ \ \ \ \ \ \textcolor{keyword}{async\ def\ }create\_tables():}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00104}00104\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{async}\ \textcolor{keyword}{with}\ self.\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_aa0e496074df89ca930fe1c2081c58eed}{engine}}.begin()\ \textcolor{keyword}{as}\ conn:}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00105}00105\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ await\ conn.run\_sync(self.\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a81dafa727c1f3a38ae0f77c73c6d2d69}{Base}}.metadata.create\_all)}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00106}00106\ }
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00107}00107\ \ \ \ \ \ \ \ \ \textcolor{keyword}{import}\ asyncio}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00108}00108\ \ \ \ \ \ \ \ \ asyncio.run(create\_tables())}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00109}00109\ }
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00110}\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a1ffa8d8c57b29a1fcccacbccc8c2e879}{00110}}\ \ \ \ \ \textcolor{keyword}{async\ def\ }\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a1ffa8d8c57b29a1fcccacbccc8c2e879}{get\_db}}(self):}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00111}00111\ \ \ \ \ \ \ \ \ \textcolor{keyword}{async}\ \textcolor{keyword}{with}\ self.\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_ac1e3119ff7a8c0e5a0ed618ec7fff11a}{SessionLocal}}()\ \textcolor{keyword}{as}\ db:}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00112}00112\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00113}00113\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{yield}\ db}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00114}00114\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{finally}:}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00115}00115\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ await\ db.close()}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00116}00116\ }
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00117}\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a4568597320933387ce409814f70677b5}{00117}}\ \ \ \ \ \textcolor{keyword}{async\ def\ }\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a4568597320933387ce409814f70677b5}{create\_call\_context}}(self,\ db:\ AsyncSession,\ call\_context):}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00118}00118\ \ \ \ \ \ \ \ \ db\_call\_context\ =\ self.\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a1c77872953fb5b143be1c3c81cb28df0}{CallContextModel}}(}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00119}00119\ \ \ \ \ \ \ \ \ \ \ \ \ call\_sid=call\_context.call\_sid,}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00120}00120\ \ \ \ \ \ \ \ \ \ \ \ \ stream\_sid=call\_context.stream\_sid,}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00121}00121\ \ \ \ \ \ \ \ \ \ \ \ \ call\_ended=call\_context.call\_ended,}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00122}00122\ \ \ \ \ \ \ \ \ \ \ \ \ user\_context=json.dumps(call\_context.user\_context),}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00123}00123\ \ \ \ \ \ \ \ \ \ \ \ \ system\_message=call\_context.system\_message,}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00124}00124\ \ \ \ \ \ \ \ \ \ \ \ \ initial\_message=call\_context.initial\_message,}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00125}00125\ \ \ \ \ \ \ \ \ \ \ \ \ start\_time=call\_context.start\_time,}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00126}00126\ \ \ \ \ \ \ \ \ \ \ \ \ end\_time=call\_context.end\_time,}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00127}00127\ \ \ \ \ \ \ \ \ \ \ \ \ final\_status=call\_context.final\_status,}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00128}00128\ \ \ \ \ \ \ \ \ \ \ \ \ to\_number=call\_context.to\_number,}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00129}00129\ \ \ \ \ \ \ \ \ \ \ \ \ from\_number=call\_context.from\_number,}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00130}00130\ \ \ \ \ \ \ \ \ \ \ \ \ contact\_id=call\_context.contact\_id}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00131}00131\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00132}00132\ \ \ \ \ \ \ \ \ db.add(db\_call\_context)}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00133}00133\ \ \ \ \ \ \ \ \ await\ db.commit()}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00134}00134\ \ \ \ \ \ \ \ \ await\ db.refresh(db\_call\_context)}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00135}00135\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ db\_call\_context}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00136}00136\ }
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00137}\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_aa1c04249ee7883b9bb622488bf515876}{00137}}\ \ \ \ \ \textcolor{keyword}{async\ def\ }\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_aa1c04249ee7883b9bb622488bf515876}{get\_call\_context}}(self,\ db:\ AsyncSession,\ call\_sid:\ str):}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00138}00138\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ await\ db.query(self.\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a1c77872953fb5b143be1c3c81cb28df0}{CallContextModel}}).filter(self.\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a1c77872953fb5b143be1c3c81cb28df0}{CallContextModel}}.call\_sid\ ==\ call\_sid).first()}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00139}00139\ }
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00140}\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_ace4b672eac7f6e2517e400a11c0e16f8}{00140}}\ \ \ \ \ \textcolor{keyword}{async\ def\ }\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_ace4b672eac7f6e2517e400a11c0e16f8}{update\_call\_context}}(self,\ db:\ AsyncSession,\ call\_sid:\ str,\ call\_context):}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00141}00141\ \ \ \ \ \ \ \ \ db\_call\_context\ =\ await\ db.query(self.\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a1c77872953fb5b143be1c3c81cb28df0}{CallContextModel}}).filter(}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00142}00142\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a1c77872953fb5b143be1c3c81cb28df0}{CallContextModel}}.call\_sid\ ==\ call\_sid).first()}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00143}00143\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ db\_call\_context:}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00144}00144\ \ \ \ \ \ \ \ \ \ \ \ \ db\_call\_context.stream\_sid\ =\ call\_context.stream\_sid}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00145}00145\ \ \ \ \ \ \ \ \ \ \ \ \ db\_call\_context.call\_ended\ =\ call\_context.call\_ended}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00146}00146\ \ \ \ \ \ \ \ \ \ \ \ \ db\_call\_context.user\_context\ =\ json.dumps(call\_context.user\_context)}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00147}00147\ \ \ \ \ \ \ \ \ \ \ \ \ db\_call\_context.system\_message\ =\ call\_context.system\_message}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00148}00148\ \ \ \ \ \ \ \ \ \ \ \ \ db\_call\_context.initial\_message\ =\ call\_context.initial\_message}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00149}00149\ \ \ \ \ \ \ \ \ \ \ \ \ db\_call\_context.start\_time\ =\ call\_context.start\_time}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00150}00150\ \ \ \ \ \ \ \ \ \ \ \ \ db\_call\_context.end\_time\ =\ call\_context.end\_time}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00151}00151\ \ \ \ \ \ \ \ \ \ \ \ \ db\_call\_context.final\_status\ =\ call\_context.final\_status}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00152}00152\ \ \ \ \ \ \ \ \ \ \ \ \ db\_call\_context.to\_number\ =\ call\_context.to\_number}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00153}00153\ \ \ \ \ \ \ \ \ \ \ \ \ db\_call\_context.from\_number\ =\ call\_context.from\_number}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00154}00154\ \ \ \ \ \ \ \ \ \ \ \ \ db\_call\_context.contact\_id\ =\ call\_context.contact\_id}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00155}00155\ \ \ \ \ \ \ \ \ \ \ \ \ await\ db.commit()}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00156}00156\ \ \ \ \ \ \ \ \ \ \ \ \ await\ db.refresh(db\_call\_context)}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00157}00157\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ db\_call\_context}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00158}00158\ }
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00159}\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a112a5da11be1141cc1a42e4341bc2cc0}{00159}}\ \ \ \ \ \textcolor{keyword}{async\ def\ }\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a112a5da11be1141cc1a42e4341bc2cc0}{delete\_call\_context}}(self,\ db:\ AsyncSession,\ call\_sid:\ str):}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00160}00160\ \ \ \ \ \ \ \ \ db\_call\_context\ =\ await\ db.query(self.\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a1c77872953fb5b143be1c3c81cb28df0}{CallContextModel}}).filter(}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00161}00161\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a1c77872953fb5b143be1c3c81cb28df0}{CallContextModel}}.call\_sid\ ==\ call\_sid).first()}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00162}00162\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ db\_call\_context:}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00163}00163\ \ \ \ \ \ \ \ \ \ \ \ \ await\ db.delete(db\_call\_context)}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00164}00164\ \ \ \ \ \ \ \ \ \ \ \ \ await\ db.commit()}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00165}00165\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ db\_call\_context}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00166}00166\ }
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00167}\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a559f2834ffc812d2cfebc9b77cac5292}{00167}}\ \ \ \ \ \textcolor{keyword}{async\ def\ }\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a559f2834ffc812d2cfebc9b77cac5292}{get\_all\_call\_contexts}}(self,\ db:\ AsyncSession):}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00168}00168\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ await\ db.query(self.\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a1c77872953fb5b143be1c3c81cb28df0}{CallContextModel}}).all()}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00169}00169\ }
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00170}\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a8a89261d69ab3d7160c33ba9d395aea3}{00170}}\ \ \ \ \ \textcolor{keyword}{async\ def\ }\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a8a89261d69ab3d7160c33ba9d395aea3}{create\_transcription}}(self,\ db:\ AsyncSession,\ call\_sid:\ str,\ transcription\_text:\ str):}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00171}00171\ \ \ \ \ \ \ \ \ db\_transcription\ =\ self.\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a941701a4a1ed39cba8424bda78a93dc5}{TranscriptionModel}}(}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00172}00172\ \ \ \ \ \ \ \ \ \ \ \ \ call\_id=call\_sid,}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00173}00173\ \ \ \ \ \ \ \ \ \ \ \ \ transcription\_text=transcription\_text}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00174}00174\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00175}00175\ \ \ \ \ \ \ \ \ db.add(db\_transcription)}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00176}00176\ \ \ \ \ \ \ \ \ await\ db.commit()}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00177}00177\ \ \ \ \ \ \ \ \ await\ db.refresh(db\_transcription)}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00178}00178\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ db\_transcription}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00179}00179\ }
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00180}\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a58ea46645c51f617923f7b352c436db5}{00180}}\ \ \ \ \ \textcolor{keyword}{async\ def\ }\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a58ea46645c51f617923f7b352c436db5}{get\_transcription}}(self,\ db:\ AsyncSession,\ call\_sid:\ str):}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00181}00181\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ await\ db.query(self.\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a941701a4a1ed39cba8424bda78a93dc5}{TranscriptionModel}}).filter(self.\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a941701a4a1ed39cba8424bda78a93dc5}{TranscriptionModel}}.call\_id\ ==\ call\_sid).first()}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00182}00182\ }
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00183}\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_aeef4f32f5b1d75e9b9ca3ae07cf2af19}{00183}}\ \ \ \ \ \textcolor{keyword}{async\ def\ }\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_aeef4f32f5b1d75e9b9ca3ae07cf2af19}{delete\_transcription}}(self,\ db:\ AsyncSession,\ call\_sid:\ str):}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00184}00184\ \ \ \ \ \ \ \ \ db\_transcription\ =\ await\ db.query(self.\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a941701a4a1ed39cba8424bda78a93dc5}{TranscriptionModel}}).filter(}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00185}00185\ \ \ \ \ \ \ \ \ \ \ \ \ self.\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a941701a4a1ed39cba8424bda78a93dc5}{TranscriptionModel}}.call\_id\ ==\ call\_sid).first()}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00186}00186\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ db\_transcription:}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00187}00187\ \ \ \ \ \ \ \ \ \ \ \ \ await\ db.delete(db\_transcription)}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00188}00188\ \ \ \ \ \ \ \ \ \ \ \ \ await\ db.commit()}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00189}00189\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ db\_transcription}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00190}00190\ }
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00191}\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_adf7c8b481f42d695d96fb0a2b14493fd}{00191}}\ \ \ \ \ \textcolor{keyword}{async\ def\ }\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_adf7c8b481f42d695d96fb0a2b14493fd}{get\_all\_contacts}}(self,\ db:\ AsyncSession):}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00192}00192\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ await\ db.query(self.\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_aca6cf2c61b69b0c1b7852660d101cd92}{ContactModel}}).all()}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00193}00193\ }
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00194}\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a756cf3a6ca1af8b0a6c4ea8ed828a78a}{00194}}\ \ \ \ \ \textcolor{keyword}{async\ def\ }\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_a756cf3a6ca1af8b0a6c4ea8ed828a78a}{get\_contact\_by\_phone}}(self,\ db:\ AsyncSession,\ phone\_number:\ str):}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00195}00195\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ await\ db.query(self.\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_aca6cf2c61b69b0c1b7852660d101cd92}{ContactModel}}).filter(self.\mbox{\hyperlink{classdatabase__manager_1_1_database_manager_aca6cf2c61b69b0c1b7852660d101cd92}{ContactModel}}.phone\_number\ ==\ phone\_number).first()}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00196}00196\ }
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00197}00197\ }
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00198}00198\ \textcolor{comment}{\#\ Example\ usage\ of\ the\ DatabaseManager\ class:}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00199}00199\ \textcolor{keywordflow}{if}\ \_\_name\_\_\ ==\ \textcolor{stringliteral}{"{}\_\_main\_\_"{}}:}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00200}\mbox{\hyperlink{namespacedatabase__manager_a661dca54f5003d534e2aa05b0aa070ab}{00200}}\ \ \ \ \ db\_manager\ =\ \mbox{\hyperlink{classdatabase__manager_1_1_database_manager}{DatabaseManager}}()}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00201}00201\ }
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00202}00202\ }
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00203}00203\ \ \ \ \ \textcolor{comment}{\#\ Example\ of\ using\ the\ DatabaseManager\ class\ in\ an\ async\ context}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00204}\mbox{\hyperlink{namespacedatabase__manager_ae9711d1f326eb9746c0444b40d96c838}{00204}}\ \ \ \ \ \textcolor{keyword}{async\ def\ }\mbox{\hyperlink{namespacedatabase__manager_ae9711d1f326eb9746c0444b40d96c838}{main}}():}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00205}00205\ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00206}00206\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ Main\ Method}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00207}00207\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00208}00208\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ This\ method\ is\ used\ to\ create\ a\ new\ contact\ and\ a\ new\ call\ context\ in\ the\ database.}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00209}00209\ \textcolor{stringliteral}{}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00210}00210\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ :return:\ None}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00211}00211\ \textcolor{stringliteral}{\ \ \ \ \ \ \ \ "{}"{}"{}}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00212}00212\ \ \ \ \ \ \ \ \ \textcolor{keyword}{async}\ \textcolor{keyword}{with}\ db\_manager.SessionLocal()\ \textcolor{keyword}{as}\ db:}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00213}00213\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Create\ a\ new\ contact}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00214}00214\ \ \ \ \ \ \ \ \ \ \ \ \ new\_contact\ =\ db\_manager.ContactModel(phone\_number=\textcolor{stringliteral}{"{}1234567890"{}})}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00215}00215\ \ \ \ \ \ \ \ \ \ \ \ \ db.add(new\_contact)}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00216}00216\ \ \ \ \ \ \ \ \ \ \ \ \ await\ db.commit()}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00217}00217\ }
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00218}00218\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Create\ a\ new\ call\ context}}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00219}00219\ \ \ \ \ \ \ \ \ \ \ \ \ new\_call\_context\ =\ db\_manager.CallContextModel(}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00220}00220\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ call\_sid=\textcolor{stringliteral}{"{}ABC123"{}},}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00221}00221\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ stream\_sid=\textcolor{stringliteral}{"{}STREAM123"{}},}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00222}00222\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ call\_ended=\textcolor{keyword}{False},}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00223}00223\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ user\_context=json.dumps([\textcolor{stringliteral}{"{}user\_action"{}}]),}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00224}00224\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ system\_message=\textcolor{stringliteral}{"{}System\ message"{}},}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00225}00225\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ initial\_message=\textcolor{stringliteral}{"{}Hello"{}},}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00226}00226\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ start\_time=datetime.utcnow(),}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00227}00227\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ end\_time=\textcolor{keywordtype}{None},}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00228}00228\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ final\_status=\textcolor{stringliteral}{"{}in\_progress"{}},}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00229}00229\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ to\_number=\textcolor{stringliteral}{"{}1234567890"{}},}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00230}00230\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ from\_number=\textcolor{stringliteral}{"{}0987654321"{}},}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00231}00231\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ contact\_id=new\_contact.contact\_id}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00232}00232\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00233}00233\ \ \ \ \ \ \ \ \ \ \ \ \ db.add(new\_call\_context)}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00234}00234\ \ \ \ \ \ \ \ \ \ \ \ \ await\ db.commit()}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00235}00235\ }
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00236}00236\ }
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00237}00237\ \ \ \ \ \textcolor{keyword}{import}\ asyncio}
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00238}00238\ }
\DoxyCodeLine{\Hypertarget{database__manager_8py_source_l00239}00239\ \ \ \ \ asyncio.run(\mbox{\hyperlink{namespacedatabase__manager_ae9711d1f326eb9746c0444b40d96c838}{main}}())}

\end{DoxyCode}
