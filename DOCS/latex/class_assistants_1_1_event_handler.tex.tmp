\doxysection{Event\+Handler Class Reference}
\hypertarget{class_assistants_1_1_event_handler}{}\label{class_assistants_1_1_event_handler}\index{EventHandler@{EventHandler}}


Inheritance diagram for Event\+Handler\+:
% FIG 0


Collaboration diagram for Event\+Handler\+:
% FIG 1
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{class_assistants_1_1_event_handler_abdd362d5f799ad16b5d6700efe590290}{\+\_\+\+\_\+init\+\_\+\+\_\+}} (self)
\item 
\mbox{\hyperlink{class_assistants_1_1_event_handler_aff0cd190f2fae5b016d4faf3c1c8e073}{on\+\_\+event}} (self, event)
\item 
\mbox{\hyperlink{class_assistants_1_1_event_handler_ae941d8bdb10c17fe7bca834a1f24038a}{on\+\_\+text\+\_\+created}} (self, text)
\item 
\mbox{\hyperlink{class_assistants_1_1_event_handler_a8cb3855bd5daa733879e2626db9ad227}{on\+\_\+text\+\_\+delta}} (self, delta, snapshot)
\item 
\mbox{\hyperlink{class_assistants_1_1_event_handler_ad4402d96c3f2f5a5c2a53aebbf7b343d}{on\+\_\+text\+\_\+done}} (self, text)
\item 
\mbox{\hyperlink{class_assistants_1_1_event_handler_a388bc733a67fc1ac664c79116b82a2c4}{on\+\_\+tool\+\_\+call\+\_\+created}} (self, tool\+\_\+call)
\item 
\mbox{\hyperlink{class_assistants_1_1_event_handler_a12334a2e56f9b3c7be63a4128e71aeaa}{on\+\_\+tool\+\_\+call\+\_\+delta}} (self, delta, snapshot)
\item 
\mbox{\hyperlink{class_assistants_1_1_event_handler_aae25b48c0a1a615b819caf177dd00a94}{on\+\_\+tool\+\_\+call\+\_\+done}} (self, tool\+\_\+call)
\item 
\mbox{\hyperlink{class_assistants_1_1_event_handler_ae227e8e35e232ac8cb29763bdfcdb4ee}{format\+\_\+annotation}} (self, text)
\item 
\mbox{\hyperlink{class_assistants_1_1_event_handler_a6092c613dbaf790707f8cd30fbc54744}{create\+\_\+file\+\_\+link}} (self, file\+\_\+name, file\+\_\+id)
\end{DoxyCompactItemize}
\doxysubsubsection*{Data Fields}
\begin{DoxyCompactItemize}
\item 
dict \mbox{\hyperlink{class_assistants_1_1_event_handler_a58320a108df6e2b18701bb903c9666cb}{session\+\_\+state}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
\begin{DoxyVerb}Class EventHandler

This class is a subclass of the openai.AssistantEventHandler class and contains various methods that handle different events related to the OpenAI Assistant.

Attributes:
- session_state (dict): A dictionary that stores the current state of the session, including chat log, tool calls, current message, current markdown, current tool input, and current tool input markdown.

Methods:
- on_event(event): Handles the general event. This method is not implemented in the EventHandler class and needs to be overridden in a subclass.
- on_text_created(text): Handles the event when a new text is created. It sets the current message to empty and prints "Assistant:".
- on_text_delta(delta, snapshot): Handles the event when a delta change is made to the text. It updates the current message in the session state and prints the updated text.
- on_text_done(text): Handles the event when the text is complete. It formats the annotation in the text, prints the formatted text, and appends it to the chat log in the session state.
- on_tool_call_created(tool_call): Handles the event when a tool call is created. If the tool call is of type "code_interpreter", it sets the current tool input to empty and prints "Assistant:".
- on_tool_call_delta(delta, snapshot): Handles the event when a delta change is made to the tool call. If the delta is of type "code_interpreter", it updates the current tool input in the session state and prints the input code.
- on_tool_call_done(tool_call): Handles the event when the tool call is complete. It appends the tool call to the tool calls list in the session state. If the tool call is of type "code_interpreter", it prints the input code and outputs.
- format_annotation(text): Formats the annotation in the given text by replacing annotation texts with numbered references and creating download links for file citations. Returns the formatted text.
- create_file_link(file_name, file_id): Creates a download link for the given file name and file ID. Returns the link tag.

Note: This class needs to be subclassed and the on_event() method needs to be implemented in the subclass.\end{DoxyVerb}
 

\doxysubsection{Constructor \& Destructor Documentation}
\Hypertarget{class_assistants_1_1_event_handler_abdd362d5f799ad16b5d6700efe590290}\index{EventHandler@{EventHandler}!\_\_init\_\_@{\_\_init\_\_}}
\index{\_\_init\_\_@{\_\_init\_\_}!EventHandler@{EventHandler}}
\doxysubsubsection{\texorpdfstring{\_\_init\_\_()}{\_\_init\_\_()}}
{\footnotesize\ttfamily \label{class_assistants_1_1_event_handler_abdd362d5f799ad16b5d6700efe590290} 
\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{keyword}{def\ }\_\_init\_\_(self):}
\DoxyCodeLine{00065\ }
\DoxyCodeLine{00066\ \ \ \ \ \ \ \ \ super().\_\_init\_\_()}
\DoxyCodeLine{00067\ \ \ \ \ \ \ \ \ self.session\_state\ =\ \{}
\DoxyCodeLine{00068\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}chat\_log"{}}:\ [],}
\DoxyCodeLine{00069\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}tool\_calls"{}}:\ [],}
\DoxyCodeLine{00070\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}current\_message"{}}:\ \textcolor{stringliteral}{"{}"{}},}
\DoxyCodeLine{00071\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}current\_markdown"{}}:\ \textcolor{stringliteral}{"{}"{}},}
\DoxyCodeLine{00072\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}current\_tool\_input"{}}:\ \textcolor{stringliteral}{"{}"{}},}
\DoxyCodeLine{00073\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}current\_tool\_input\_markdown"{}}:\ \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{00074\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00075\ }

\end{DoxyCode}


References \mbox{\hyperlink{l00064}{Event\+Handler.\+\_\+\+\_\+init\+\_\+\+\_\+()}}.



Referenced by \mbox{\hyperlink{l00064}{Event\+Handler.\+\_\+\+\_\+init\+\_\+\+\_\+()}}.

Here is the call graph for this function\+:
% FIG 2
Here is the caller graph for this function\+:
% FIG 3


\doxysubsection{Member Function Documentation}
\Hypertarget{class_assistants_1_1_event_handler_a6092c613dbaf790707f8cd30fbc54744}\index{EventHandler@{EventHandler}!create\_file\_link@{create\_file\_link}}
\index{create\_file\_link@{create\_file\_link}!EventHandler@{EventHandler}}
\doxysubsubsection{\texorpdfstring{create\_file\_link()}{create\_file\_link()}}
{\footnotesize\ttfamily \label{class_assistants_1_1_event_handler_a6092c613dbaf790707f8cd30fbc54744} 
create\+\_\+file\+\_\+link (\begin{DoxyParamCaption}\item[{}]{self}{, }\item[{}]{file\+\_\+name}{, }\item[{}]{file\+\_\+id}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00184\ \ \ \ \ \textcolor{keyword}{def\ }create\_file\_link(self,\ file\_name,\ file\_id):}
\DoxyCodeLine{00185\ \ \ \ \ \ \ \ \ content\ =\ client.files.content(file\_id)}
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ content\_type\ =\ content.response.headers[\textcolor{stringliteral}{"{}content-\/type"{}}]}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ b64\ =\ base64.b64encode(content.text.encode(content.encoding)).decode()}
\DoxyCodeLine{00188\ \ \ \ \ \ \ \ \ link\_tag\ =\ f\textcolor{stringliteral}{'<a\ href="{}data:\{content\_type\};base64,\{b64\}"{}\ download="{}\{file\_name\}"{}>Download\ Link</a>'}}
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ link\_tag}
\DoxyCodeLine{00190\ }
\DoxyCodeLine{00191\ \textcolor{preprocessor}{@log\_function\_call}}

\end{DoxyCode}


Referenced by \mbox{\hyperlink{l00164}{Event\+Handler.\+format\+\_\+annotation()}}.

Here is the caller graph for this function\+:
% FIG 4
\Hypertarget{class_assistants_1_1_event_handler_ae227e8e35e232ac8cb29763bdfcdb4ee}\index{EventHandler@{EventHandler}!format\_annotation@{format\_annotation}}
\index{format\_annotation@{format\_annotation}!EventHandler@{EventHandler}}
\doxysubsubsection{\texorpdfstring{format\_annotation()}{format\_annotation()}}
{\footnotesize\ttfamily \label{class_assistants_1_1_event_handler_ae227e8e35e232ac8cb29763bdfcdb4ee} 
format\+\_\+annotation (\begin{DoxyParamCaption}\item[{}]{self}{, }\item[{}]{text}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00164\ \ \ \ \ \textcolor{keyword}{def\ }format\_annotation(self,\ text):}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ citations\ =\ []}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ text\_value\ =\ text.value}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ index,\ annotation\ \textcolor{keywordflow}{in}\ enumerate(text.annotations):}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \ \ \ \ text\_value\ =\ text\_value.replace(annotation.text,\ f\textcolor{stringliteral}{"{}\ [\{index\}]"{}})}
\DoxyCodeLine{00169\ }
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ file\_citation\ :=\ getattr(annotation,\ \textcolor{stringliteral}{"{}file\_citation"{}},\ \textcolor{keywordtype}{None}):}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ cited\_file\ =\ client.files.retrieve(file\_citation.file\_id)}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ citations.append(}
\DoxyCodeLine{00173\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ f\textcolor{stringliteral}{"{}[\{index\}]\ \{file\_citation.quote\}\ from\ \{cited\_file.filename\}"{}}}
\DoxyCodeLine{00174\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{00175\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ file\_path\ :=\ getattr(annotation,\ \textcolor{stringliteral}{"{}file\_path"{}},\ \textcolor{keywordtype}{None}):}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ link\_tag\ =\ self.create\_file\_link(}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ annotation.text.split(\textcolor{stringliteral}{"{}/"{}})[-\/1],}
\DoxyCodeLine{00178\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ file\_path.file\_id,}
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ text\_value\ =\ re.sub(\textcolor{stringliteral}{r"{}\(\backslash\)[(.*?)\(\backslash\)]\(\backslash\)s*\(\backslash\)(\(\backslash\)s*(.*?)\(\backslash\)s*\(\backslash\))"{}},\ link\_tag,\ text\_value)}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ text\_value\ +=\ \textcolor{stringliteral}{"{}\(\backslash\)n\(\backslash\)n"{}}\ +\ \textcolor{stringliteral}{"{}\(\backslash\)n"{}}.join(citations)}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ text\_value}
\DoxyCodeLine{00183\ }

\end{DoxyCode}


References \mbox{\hyperlink{l00184}{Event\+Handler.\+create\+\_\+file\+\_\+link()}}.



Referenced by \mbox{\hyperlink{l00097}{Event\+Handler.\+on\+\_\+text\+\_\+done()}}.

Here is the call graph for this function\+:
% FIG 5
Here is the caller graph for this function\+:
% FIG 6
\Hypertarget{class_assistants_1_1_event_handler_aff0cd190f2fae5b016d4faf3c1c8e073}\index{EventHandler@{EventHandler}!on\_event@{on\_event}}
\index{on\_event@{on\_event}!EventHandler@{EventHandler}}
\doxysubsubsection{\texorpdfstring{on\_event()}{on\_event()}}
{\footnotesize\ttfamily \label{class_assistants_1_1_event_handler_aff0cd190f2fae5b016d4faf3c1c8e073} 
on\+\_\+event (\begin{DoxyParamCaption}\item[{}]{self}{, }\item[{}]{event}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{keyword}{def\ }on\_event(self,\ event):}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{pass}}
\DoxyCodeLine{00079\ }

\end{DoxyCode}
\Hypertarget{class_assistants_1_1_event_handler_ae941d8bdb10c17fe7bca834a1f24038a}\index{EventHandler@{EventHandler}!on\_text\_created@{on\_text\_created}}
\index{on\_text\_created@{on\_text\_created}!EventHandler@{EventHandler}}
\doxysubsubsection{\texorpdfstring{on\_text\_created()}{on\_text\_created()}}
{\footnotesize\ttfamily \label{class_assistants_1_1_event_handler_ae941d8bdb10c17fe7bca834a1f24038a} 
on\+\_\+text\+\_\+created (\begin{DoxyParamCaption}\item[{}]{self}{, }\item[{}]{text}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{keyword}{def\ }on\_text\_created(self,\ text):}
\DoxyCodeLine{00083\ \ \ \ \ \ \ \ \ self.session\_state[\textcolor{stringliteral}{"{}current\_message"{}}]\ =\ \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{00084\ \ \ \ \ \ \ \ \ print(\textcolor{stringliteral}{"{}Assistant:"{}})}
\DoxyCodeLine{00085\ }

\end{DoxyCode}


References \mbox{\hyperlink{l00067}{Event\+Handler.\+session\+\_\+state}}.

\Hypertarget{class_assistants_1_1_event_handler_a8cb3855bd5daa733879e2626db9ad227}\index{EventHandler@{EventHandler}!on\_text\_delta@{on\_text\_delta}}
\index{on\_text\_delta@{on\_text\_delta}!EventHandler@{EventHandler}}
\doxysubsubsection{\texorpdfstring{on\_text\_delta()}{on\_text\_delta()}}
{\footnotesize\ttfamily \label{class_assistants_1_1_event_handler_a8cb3855bd5daa733879e2626db9ad227} 
on\+\_\+text\+\_\+delta (\begin{DoxyParamCaption}\item[{}]{self}{, }\item[{}]{delta}{, }\item[{}]{snapshot}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{keyword}{def\ }on\_text\_delta(self,\ delta,\ snapshot):}
\DoxyCodeLine{00089\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ snapshot.value:}
\DoxyCodeLine{00090\ \ \ \ \ \ \ \ \ \ \ \ \ text\_value\ =\ re.sub(}
\DoxyCodeLine{00091\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{r"{}\(\backslash\)[(.*?)\(\backslash\)]\(\backslash\)s*\(\backslash\)(\(\backslash\)s*(.*?)\(\backslash\)s*\(\backslash\))"{}},\ \textcolor{stringliteral}{"{}Download\ Link"{}},\ snapshot.value}
\DoxyCodeLine{00092\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{00093\ \ \ \ \ \ \ \ \ \ \ \ \ self.session\_state[\textcolor{stringliteral}{"{}current\_message"{}}]\ =\ text\_value}
\DoxyCodeLine{00094\ \ \ \ \ \ \ \ \ \ \ \ \ print(text\_value,\ end=\textcolor{stringliteral}{"{}"{}},\ flush=\textcolor{keyword}{True})}

\end{DoxyCode}


References \mbox{\hyperlink{l00067}{Event\+Handler.\+session\+\_\+state}}.

\Hypertarget{class_assistants_1_1_event_handler_ad4402d96c3f2f5a5c2a53aebbf7b343d}\index{EventHandler@{EventHandler}!on\_text\_done@{on\_text\_done}}
\index{on\_text\_done@{on\_text\_done}!EventHandler@{EventHandler}}
\doxysubsubsection{\texorpdfstring{on\_text\_done()}{on\_text\_done()}}
{\footnotesize\ttfamily \label{class_assistants_1_1_event_handler_ad4402d96c3f2f5a5c2a53aebbf7b343d} 
on\+\_\+text\+\_\+done (\begin{DoxyParamCaption}\item[{}]{self}{, }\item[{}]{text}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00097\ \ \ \ \ \textcolor{keyword}{def\ }on\_text\_done(self,\ text):}
\DoxyCodeLine{00098\ \ \ \ \ \ \ \ \ format\_text\ =\ self.format\_annotation(text)}
\DoxyCodeLine{00099\ \ \ \ \ \ \ \ \ print(\textcolor{stringliteral}{"{}\(\backslash\)n"{}}\ +\ format\_text)}
\DoxyCodeLine{00100\ \ \ \ \ \ \ \ \ self.session\_state[\textcolor{stringliteral}{"{}chat\_log"{}}].append(\{\textcolor{stringliteral}{"{}name"{}}:\ \textcolor{stringliteral}{"{}assistant"{}},\ \textcolor{stringliteral}{"{}msg"{}}:\ format\_text\})}
\DoxyCodeLine{00101\ }

\end{DoxyCode}


References \mbox{\hyperlink{l00164}{Event\+Handler.\+format\+\_\+annotation()}}, and \mbox{\hyperlink{l00067}{Event\+Handler.\+session\+\_\+state}}.

Here is the call graph for this function\+:
% FIG 7
\Hypertarget{class_assistants_1_1_event_handler_a388bc733a67fc1ac664c79116b82a2c4}\index{EventHandler@{EventHandler}!on\_tool\_call\_created@{on\_tool\_call\_created}}
\index{on\_tool\_call\_created@{on\_tool\_call\_created}!EventHandler@{EventHandler}}
\doxysubsubsection{\texorpdfstring{on\_tool\_call\_created()}{on\_tool\_call\_created()}}
{\footnotesize\ttfamily \label{class_assistants_1_1_event_handler_a388bc733a67fc1ac664c79116b82a2c4} 
on\+\_\+tool\+\_\+call\+\_\+created (\begin{DoxyParamCaption}\item[{}]{self}{, }\item[{}]{tool\+\_\+call}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00103\ \ \ \ \ \textcolor{keyword}{def\ }on\_tool\_call\_created(self,\ tool\_call):}
\DoxyCodeLine{00104\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ tool\_call.type\ ==\ \textcolor{stringliteral}{"{}code\_interpreter"{}}:}
\DoxyCodeLine{00105\ \ \ \ \ \ \ \ \ \ \ \ \ self.session\_state[\textcolor{stringliteral}{"{}current\_tool\_input"{}}]\ =\ \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{00106\ \ \ \ \ \ \ \ \ \ \ \ \ print(\textcolor{stringliteral}{"{}Assistant:"{}})}
\DoxyCodeLine{00107\ }

\end{DoxyCode}


References \mbox{\hyperlink{l00067}{Event\+Handler.\+session\+\_\+state}}.

\Hypertarget{class_assistants_1_1_event_handler_a12334a2e56f9b3c7be63a4128e71aeaa}\index{EventHandler@{EventHandler}!on\_tool\_call\_delta@{on\_tool\_call\_delta}}
\index{on\_tool\_call\_delta@{on\_tool\_call\_delta}!EventHandler@{EventHandler}}
\doxysubsubsection{\texorpdfstring{on\_tool\_call\_delta()}{on\_tool\_call\_delta()}}
{\footnotesize\ttfamily \label{class_assistants_1_1_event_handler_a12334a2e56f9b3c7be63a4128e71aeaa} 
on\+\_\+tool\+\_\+call\+\_\+delta (\begin{DoxyParamCaption}\item[{}]{self}{, }\item[{}]{delta}{, }\item[{}]{snapshot}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00109\ \ \ \ \ \textcolor{keyword}{def\ }on\_tool\_call\_delta(self,\ delta,\ snapshot):}
\DoxyCodeLine{00110\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ delta.type\ ==\ \textcolor{stringliteral}{"{}code\_interpreter"{}}:}
\DoxyCodeLine{00111\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ delta.code\_interpreter.input:}
\DoxyCodeLine{00112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.session\_state[\textcolor{stringliteral}{"{}current\_tool\_input"{}}]\ +=\ delta.code\_interpreter.input}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ input\_code\ =\ f\textcolor{stringliteral}{"{}\#\#\#\ code\ interpreter\(\backslash\)ninput:\(\backslash\)n\`{}\`{}\`{}python\(\backslash\)n\{self.session\_state['current\_tool\_input']\}\(\backslash\)n\`{}\`{}\`{}"{}}}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(input\_code,\ end=\textcolor{stringliteral}{"{}"{}},\ flush=\textcolor{keyword}{True})}
\DoxyCodeLine{00115\ }
\DoxyCodeLine{00116\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ delta.code\_interpreter.outputs:}
\DoxyCodeLine{00117\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ output\ \textcolor{keywordflow}{in}\ delta.code\_interpreter.outputs:}
\DoxyCodeLine{00118\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ output.type\ ==\ \textcolor{stringliteral}{"{}logs"{}}:}
\DoxyCodeLine{00119\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{pass}}
\DoxyCodeLine{00120\ }

\end{DoxyCode}


References \mbox{\hyperlink{l00067}{Event\+Handler.\+session\+\_\+state}}.

\Hypertarget{class_assistants_1_1_event_handler_aae25b48c0a1a615b819caf177dd00a94}\index{EventHandler@{EventHandler}!on\_tool\_call\_done@{on\_tool\_call\_done}}
\index{on\_tool\_call\_done@{on\_tool\_call\_done}!EventHandler@{EventHandler}}
\doxysubsubsection{\texorpdfstring{on\_tool\_call\_done()}{on\_tool\_call\_done()}}
{\footnotesize\ttfamily \label{class_assistants_1_1_event_handler_aae25b48c0a1a615b819caf177dd00a94} 
on\+\_\+tool\+\_\+call\+\_\+done (\begin{DoxyParamCaption}\item[{}]{self}{, }\item[{}]{tool\+\_\+call}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00122\ \ \ \ \ \textcolor{keyword}{def\ }on\_tool\_call\_done(self,\ tool\_call):}
\DoxyCodeLine{00123\ \ \ \ \ \ \ \ \ self.session\_state[\textcolor{stringliteral}{"{}tool\_calls"{}}].append(tool\_call)}
\DoxyCodeLine{00124\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ tool\_call.type\ ==\ \textcolor{stringliteral}{"{}code\_interpreter"{}}:}
\DoxyCodeLine{00125\ \ \ \ \ \ \ \ \ \ \ \ \ input\_code\ =\ f\textcolor{stringliteral}{"{}\#\#\#\ code\ interpreter\(\backslash\)ninput:\(\backslash\)n\`{}\`{}\`{}python\(\backslash\)n\{tool\_call.code\_interpreter.input\}\(\backslash\)n\`{}\`{}\`{}"{}}}
\DoxyCodeLine{00126\ \ \ \ \ \ \ \ \ \ \ \ \ print(input\_code)}
\DoxyCodeLine{00127\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ output\ \textcolor{keywordflow}{in}\ tool\_call.code\_interpreter.outputs:}
\DoxyCodeLine{00128\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ output.type\ ==\ \textcolor{stringliteral}{"{}logs"{}}:}
\DoxyCodeLine{00129\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ output\ =\ f\textcolor{stringliteral}{"{}\#\#\#\ code\ interpreter\(\backslash\)noutput:\(\backslash\)n\`{}\`{}\`{}\(\backslash\)n\{output.logs\}\(\backslash\)n\`{}\`{}\`{}"{}}}
\DoxyCodeLine{00130\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(output)}
\DoxyCodeLine{00131\ }
\DoxyCodeLine{00132\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{elif}\ (}
\DoxyCodeLine{00133\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tool\_call.type\ ==\ \textcolor{stringliteral}{"{}function"{}}}
\DoxyCodeLine{00134\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{and}\ self.current\_run.status\ ==\ \textcolor{stringliteral}{"{}requires\_action"{}}}
\DoxyCodeLine{00135\ \ \ \ \ \ \ \ \ ):}
\DoxyCodeLine{00136\ \ \ \ \ \ \ \ \ \ \ \ \ msg\ =\ f\textcolor{stringliteral}{"{}\#\#\#\ Function\ Calling:\ \{tool\_call.function.name\}"{}}}
\DoxyCodeLine{00137\ \ \ \ \ \ \ \ \ \ \ \ \ print(msg)}
\DoxyCodeLine{00138\ \ \ \ \ \ \ \ \ \ \ \ \ self.session\_state[\textcolor{stringliteral}{"{}chat\_log"{}}].append(\{\textcolor{stringliteral}{"{}name"{}}:\ \textcolor{stringliteral}{"{}assistant"{}},\ \textcolor{stringliteral}{"{}msg"{}}:\ msg\})}
\DoxyCodeLine{00139\ \ \ \ \ \ \ \ \ \ \ \ \ tool\_calls\ =\ self.current\_run.required\_action.submit\_tool\_outputs.tool\_calls}
\DoxyCodeLine{00140\ \ \ \ \ \ \ \ \ \ \ \ \ tool\_outputs\ =\ []}
\DoxyCodeLine{00141\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ submit\_tool\_call\ \textcolor{keywordflow}{in}\ tool\_calls:}
\DoxyCodeLine{00142\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tool\_function\_name\ =\ submit\_tool\_call.function.name}
\DoxyCodeLine{00143\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tool\_function\_arguments\ =\ json.loads(}
\DoxyCodeLine{00144\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ submit\_tool\_call.function.arguments}
\DoxyCodeLine{00145\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{00146\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tool\_function\_output\ =\ TOOL\_MAP[tool\_function\_name](}
\DoxyCodeLine{00147\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ **tool\_function\_arguments}
\DoxyCodeLine{00148\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{00149\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tool\_outputs.append(}
\DoxyCodeLine{00150\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{00151\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}tool\_call\_id"{}}:\ submit\_tool\_call.id,}
\DoxyCodeLine{00152\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}output"{}}:\ tool\_function\_output,}
\DoxyCodeLine{00153\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{00154\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{00155\ }
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ client.beta.threads.runs.submit\_tool\_outputs\_stream(}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ thread\_id=thread.id,}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ run\_id=self.current\_run.id,}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tool\_outputs=tool\_outputs,}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ event\_handler=EventHandler(),}
\DoxyCodeLine{00161\ \ \ \ \ \ \ \ \ \ \ \ \ )\ \textcolor{keyword}{as}\ stream:}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ stream.until\_done()}

\end{DoxyCode}


References \mbox{\hyperlink{l00067}{Event\+Handler.\+session\+\_\+state}}.



\doxysubsection{Field Documentation}
\Hypertarget{class_assistants_1_1_event_handler_a58320a108df6e2b18701bb903c9666cb}\index{EventHandler@{EventHandler}!session\_state@{session\_state}}
\index{session\_state@{session\_state}!EventHandler@{EventHandler}}
\doxysubsubsection{\texorpdfstring{session\_state}{session\_state}}
{\footnotesize\ttfamily \label{class_assistants_1_1_event_handler_a58320a108df6e2b18701bb903c9666cb} 
dict session\+\_\+state}

{\bfseries Initial value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{=\ \ \{}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}chat\_log"{}}:\ [],}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}tool\_calls"{}}:\ [],}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}current\_message"{}}:\ \textcolor{stringliteral}{"{}"{}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}current\_markdown"{}}:\ \textcolor{stringliteral}{"{}"{}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}current\_tool\_input"{}}:\ \textcolor{stringliteral}{"{}"{}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ \ \textcolor{stringliteral}{"{}current\_tool\_input\_markdown"{}}:\ \textcolor{stringliteral}{"{}"{}}}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \}}

\end{DoxyCode}


Referenced by \mbox{\hyperlink{l00082}{Event\+Handler.\+on\+\_\+text\+\_\+created()}}, \mbox{\hyperlink{l00088}{Event\+Handler.\+on\+\_\+text\+\_\+delta()}}, \mbox{\hyperlink{l00097}{Event\+Handler.\+on\+\_\+text\+\_\+done()}}, \mbox{\hyperlink{l00103}{Event\+Handler.\+on\+\_\+tool\+\_\+call\+\_\+created()}}, \mbox{\hyperlink{l00109}{Event\+Handler.\+on\+\_\+tool\+\_\+call\+\_\+delta()}}, and \mbox{\hyperlink{l00122}{Event\+Handler.\+on\+\_\+tool\+\_\+call\+\_\+done()}}.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
/\+Users/seanbaker/\+Downloads/\+GPTPhone (2)/\mbox{\hyperlink{_assistants_8py}{Assistants.\+py}}\end{DoxyCompactItemize}
