\doxysection{Assistant\+Service Class Reference}
\hypertarget{classservices_1_1gpt__service_1_1_assistant_service}{}\label{classservices_1_1gpt__service_1_1_assistant_service}\index{AssistantService@{AssistantService}}


Inheritance diagram for Assistant\+Service\+:
% FIG 0


Collaboration diagram for Assistant\+Service\+:
% FIG 1
\doxysubsubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classservices_1_1gpt__service_1_1_assistant_service_a94330cbe2648fc548c84dd4150df1294}{\+\_\+\+\_\+init\+\_\+\+\_\+}} (self, \mbox{\hyperlink{classservices_1_1call__details_1_1_call_context}{Call\+Context}} \mbox{\hyperlink{classservices_1_1gpt__service_1_1_abstract_l_l_m_service_a261f9f58ccbeaa962c4e675e4212c9cc}{context}})
\item 
\mbox{\hyperlink{classservices_1_1gpt__service_1_1_assistant_service_a132be0108441bc7573d3a632b2e24eeb}{create\+\_\+thread}} (\mbox{\hyperlink{classservices_1_1gpt__service_1_1_assistant_service_ad5bc32b75da65fe60067f501a4bb6665}{client}}, content, file=None)
\item 
\mbox{\hyperlink{classservices_1_1gpt__service_1_1_assistant_service_a7f68108596eb4781058bce5113e2469d}{create\+\_\+message}} (\mbox{\hyperlink{classservices_1_1gpt__service_1_1_assistant_service_ad5bc32b75da65fe60067f501a4bb6665}{client}}, thread, content, file=None)
\item 
\mbox{\hyperlink{classservices_1_1gpt__service_1_1_assistant_service_a8683968d4e3145b6c20b2c3cca00edde}{completion}} (self, str text, int interaction\+\_\+count, str role=\textquotesingle{}user\textquotesingle{}, str name=\textquotesingle{}user\textquotesingle{})
\item 
\mbox{\hyperlink{classservices_1_1gpt__service_1_1_assistant_service_a550a9c984b3b99a65e29c54b42482549}{handle\+\_\+streaming\+\_\+response}} (self, thread, text, interaction\+\_\+count)
\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions inherited from \mbox{\hyperlink{classservices_1_1gpt__service_1_1_abstract_l_l_m_service}{Abstract\+LLMService}}}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classservices_1_1gpt__service_1_1_abstract_l_l_m_service_a7216638541d56b2229d92d53e68ec58d}{set\+\_\+call\+\_\+context}} (self, \mbox{\hyperlink{classservices_1_1call__details_1_1_call_context}{Call\+Context}} \mbox{\hyperlink{classservices_1_1gpt__service_1_1_abstract_l_l_m_service_a261f9f58ccbeaa962c4e675e4212c9cc}{context}})
\item 
\mbox{\hyperlink{classservices_1_1gpt__service_1_1_abstract_l_l_m_service_aecbc052233262275fc20a8ee8dfb8a47}{reset}} (self)
\item 
\mbox{\hyperlink{classservices_1_1gpt__service_1_1_abstract_l_l_m_service_a9ebe2dbe41c7c6d0f87f7ddd7e623f90}{validate\+\_\+function\+\_\+args}} (self, args)
\item 
\mbox{\hyperlink{classservices_1_1gpt__service_1_1_abstract_l_l_m_service_a0273afee408d6d770b3dfcac0adbf045}{split\+\_\+into\+\_\+sentences}} (self, text)
\item 
\mbox{\hyperlink{classservices_1_1gpt__service_1_1_abstract_l_l_m_service_a01682f7dddb2777b9499737564c132cf}{emit\+\_\+complete\+\_\+sentences}} (self, text, interaction\+\_\+count)
\end{DoxyCompactItemize}
\doxysubsection*{Public Member Functions inherited from \mbox{\hyperlink{classservices_1_1event__manager_1_1_event_handler}{Event\+Handler}}}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classservices_1_1event__manager_1_1_event_handler_a504c5b2b70ced47ef9e67e57738a213c}{on}} (self, str event, Callable callback)
\item 
\mbox{\hyperlink{classservices_1_1event__manager_1_1_event_handler_af0b13c52d513139510df47781cf94ab9}{create\+Event}} (self, str event, \texorpdfstring{$\ast$}{*}Any args, \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}Any kwargs)
\item 
\mbox{\hyperlink{classservices_1_1event__manager_1_1_event_handler_aff0cd190f2fae5b016d4faf3c1c8e073}{on\+\_\+event}} (self, event)
\item 
\mbox{\hyperlink{classservices_1_1event__manager_1_1_event_handler_ae941d8bdb10c17fe7bca834a1f24038a}{on\+\_\+text\+\_\+created}} (self, text)
\item 
\mbox{\hyperlink{classservices_1_1event__manager_1_1_event_handler_a8cb3855bd5daa733879e2626db9ad227}{on\+\_\+text\+\_\+delta}} (self, delta, snapshot)
\item 
\mbox{\hyperlink{classservices_1_1event__manager_1_1_event_handler_ad4402d96c3f2f5a5c2a53aebbf7b343d}{on\+\_\+text\+\_\+done}} (self, text)
\item 
\mbox{\hyperlink{classservices_1_1event__manager_1_1_event_handler_a388bc733a67fc1ac664c79116b82a2c4}{on\+\_\+tool\+\_\+call\+\_\+created}} (self, tool\+\_\+call)
\item 
\mbox{\hyperlink{classservices_1_1event__manager_1_1_event_handler_a12334a2e56f9b3c7be63a4128e71aeaa}{on\+\_\+tool\+\_\+call\+\_\+delta}} (self, delta, snapshot)
\item 
\mbox{\hyperlink{classservices_1_1event__manager_1_1_event_handler_aae25b48c0a1a615b819caf177dd00a94}{on\+\_\+tool\+\_\+call\+\_\+done}} (self, tool\+\_\+call)
\item 
\mbox{\hyperlink{classservices_1_1event__manager_1_1_event_handler_abeee6d6dac7e998703cc4c5e9d623075}{submit\+\_\+tool\+\_\+outputs}} (self, tool\+\_\+outputs)
\end{DoxyCompactItemize}
\doxysubsubsection*{Data Fields}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classservices_1_1gpt__service_1_1_assistant_service_a7ea94dfe4b4adb87b01c5ecfb01781ef}{openai}} = Async\+Open\+AI(api\+\_\+key=os.\+getenv("{}OPENAI\+\_\+\+API\+\_\+\+KEY"{}))
\item 
\mbox{\hyperlink{classservices_1_1gpt__service_1_1_assistant_service_ad5bc32b75da65fe60067f501a4bb6665}{client}} = Open\+AI(api\+\_\+key=os.\+getenv("{}OPENAI\+\_\+\+API\+\_\+\+KEY"{}))
\item 
\mbox{\hyperlink{classservices_1_1gpt__service_1_1_assistant_service_a991e3bc52840f1bd0bf37b0894dd803d}{assistant\+\_\+id}} = os.\+getenv("{}ASSISTANT\+\_\+\+ID"{})
\end{DoxyCompactItemize}
\doxysubsection*{Data Fields inherited from \mbox{\hyperlink{classservices_1_1gpt__service_1_1_abstract_l_l_m_service}{Abstract\+LLMService}}}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classservices_1_1gpt__service_1_1_abstract_l_l_m_service_a0cd0ea91f0087e9eec8e7cd3abf43dbd}{system\+\_\+message}} = context.\+system\+\_\+message
\item 
\mbox{\hyperlink{classservices_1_1gpt__service_1_1_abstract_l_l_m_service_aed6dd1341f109bf1914b47f3a5e35436}{initial\+\_\+message}} = context.\+initial\+\_\+message
\item 
\mbox{\hyperlink{classservices_1_1gpt__service_1_1_abstract_l_l_m_service_a261f9f58ccbeaa962c4e675e4212c9cc}{context}} = context
\item 
list \mbox{\hyperlink{classservices_1_1gpt__service_1_1_abstract_l_l_m_service_a61ad86d80ae0ff3617e8d3bfdd41bee6}{user\+\_\+context}}
\item 
int \mbox{\hyperlink{classservices_1_1gpt__service_1_1_abstract_l_l_m_service_a1d0403c1bae0049869594a30230c932d}{partial\+\_\+response\+\_\+index}} = 0
\item 
dict \mbox{\hyperlink{classservices_1_1gpt__service_1_1_abstract_l_l_m_service_a7e5cb5af7805001ab446024551471af4}{available\+\_\+functions}} = \{\}
\item 
str \mbox{\hyperlink{classservices_1_1gpt__service_1_1_abstract_l_l_m_service_a17cc21a98b55bbc913288439e57334ff}{sentence\+\_\+buffer}} = "{}"{}
\end{DoxyCompactItemize}
\doxysubsection*{Data Fields inherited from \mbox{\hyperlink{classservices_1_1event__manager_1_1_event_handler}{Event\+Handler}}}
\begin{DoxyCompactItemize}
\item 
list \mbox{\hyperlink{classservices_1_1event__manager_1_1_event_handler_acb6617135b0fd32aae7e8bcd4491cf44}{\+\_\+events}} = \mbox{[}$\,$\mbox{]}
\item 
\mbox{\hyperlink{classservices_1_1event__manager_1_1_event_handler_ad5bc32b75da65fe60067f501a4bb6665}{client}} = client
\end{DoxyCompactItemize}
\doxysubsubsection*{Protected Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classservices_1_1gpt__service_1_1_assistant_service_afad53fa4b4a6c12dfcb867993653d99e}{\+\_\+extract\+\_\+content}} (self, message)
\end{DoxyCompactItemize}
\doxysubsection*{Protected Member Functions inherited from \mbox{\hyperlink{classservices_1_1event__manager_1_1_event_handler}{Event\+Handler}}}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classservices_1_1event__manager_1_1_event_handler_a142819f6f7c8639f2a664c46b80f337a}{\+\_\+run\+\_\+callback}} (self, Callable callback, \texorpdfstring{$\ast$}{*}Any args, \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}Any kwargs)
\end{DoxyCompactItemize}
\doxysubsubsection*{Additional Inherited Members}
\doxysubsection*{Protected Attributes inherited from \mbox{\hyperlink{classservices_1_1event__manager_1_1_event_handler}{Event\+Handler}}}
\begin{DoxyCompactItemize}
\item 
dict \mbox{\hyperlink{classservices_1_1event__manager_1_1_event_handler_af82f490d6136d2e39721b932d274778f}{\+\_\+events}} = \{\}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
\begin{DoxyVerb}.. class:: AssistantService(AbstractLLMService, AssistantEventHandler)

    AssistantService class that inherits from AbstractLLMService and AssistantEventHandler.

:param context: CallContext object.
:ivar openai: AsyncOpenAI object initialized with the OPENAI_API_KEY environment variable.
:ivar client: OpenAI object initialized with the OPENAI_API_KEY environment variable.
:ivar assistant_id: Assistant ID from the environment variable.
:ivar event_handler: AssistantEventHandler object initialized with the OpenAI client.

.. method:: create_thread(client, content, file=None)

    Creates a new thread.

:param client: OpenAI client object.
:param content: Content of the thread.
:param file: Optional file object.
:return: The created thread.

.. method:: create_message(client, thread, content, file=None)

    Creates a new message within a thread.

:param client: OpenAI client object.
:param thread: Thread object.
:param content: Content of the message.
:param file: Optional file object.
:return: None

.. method:: completion(text, interaction_count, role='user', name='user')

    Handles completion of user input.

:param text: Text input.
:param interaction_count: Number of interactions.
:param role: Role of the participant. Default is 'user'.
:param name: Name of the participant. Default is 'user'.
:return: None

.. method:: handle_streaming_response(thread, text, interaction_count)

    Handles streaming response.

:param thread: Thread object.
:param text: Text input.
:param interaction_count: Number of interactions.
:return: None

.. method:: _extract_content(message)

    Extracts content from a message.

:param message: Message object.
:return: Extracted content or None.
\end{DoxyVerb}
 

\doxysubsection{Constructor \& Destructor Documentation}
\Hypertarget{classservices_1_1gpt__service_1_1_assistant_service_a94330cbe2648fc548c84dd4150df1294}\index{AssistantService@{AssistantService}!\_\_init\_\_@{\_\_init\_\_}}
\index{\_\_init\_\_@{\_\_init\_\_}!AssistantService@{AssistantService}}
\doxysubsubsection{\texorpdfstring{\_\_init\_\_()}{\_\_init\_\_()}}
{\footnotesize\ttfamily \label{classservices_1_1gpt__service_1_1_assistant_service_a94330cbe2648fc548c84dd4150df1294} 
\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self}{, }\item[{\mbox{\hyperlink{classservices_1_1call__details_1_1_call_context}{Call\+Context}}}]{context}{}\end{DoxyParamCaption})}

\begin{DoxyVerb}Initializes an instance of the EventEmitter class.
\end{DoxyVerb}
 

Reimplemented from \mbox{\hyperlink{classservices_1_1gpt__service_1_1_abstract_l_l_m_service_a94330cbe2648fc548c84dd4150df1294}{Abstract\+LLMService}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00155\ \ \ \ \ \textcolor{keyword}{def\ }\_\_init\_\_(self,\ context:\ CallContext):}
\DoxyCodeLine{00156\ \ \ \ \ \ \ \ \ super().\_\_init\_\_(context)\ \ \textcolor{comment}{\#\ This\ initializes\ both\ AbstractLLMService\ and\ AssistantEventHandler}}
\DoxyCodeLine{00157\ \ \ \ \ \ \ \ \ self.openai\ =\ AsyncOpenAI(api\_key=os.getenv(\textcolor{stringliteral}{"{}OPENAI\_API\_KEY"{}}))}
\DoxyCodeLine{00158\ \ \ \ \ \ \ \ \ self.client\ =\ OpenAI(api\_key=os.getenv(\textcolor{stringliteral}{"{}OPENAI\_API\_KEY"{}}))}
\DoxyCodeLine{00159\ \ \ \ \ \ \ \ \ self.assistant\_id\ =\ os.getenv(\textcolor{stringliteral}{"{}ASSISTANT\_ID"{}})}
\DoxyCodeLine{00160\ \ \ \ \ \ \ \ \ self.event\_handler\ =\ AssistantEventHandler(client=self.client)}

\end{DoxyCode}


References \mbox{\hyperlink{l00155}{Assistant\+Service.\+\_\+\+\_\+init\+\_\+\+\_\+()}}.



Referenced by \mbox{\hyperlink{l00155}{Assistant\+Service.\+\_\+\+\_\+init\+\_\+\+\_\+()}}.

Here is the call graph for this function\+:
% FIG 2
Here is the caller graph for this function\+:
% FIG 3


\doxysubsection{Member Function Documentation}
\Hypertarget{classservices_1_1gpt__service_1_1_assistant_service_afad53fa4b4a6c12dfcb867993653d99e}\index{AssistantService@{AssistantService}!\_extract\_content@{\_extract\_content}}
\index{\_extract\_content@{\_extract\_content}!AssistantService@{AssistantService}}
\doxysubsubsection{\texorpdfstring{\_extract\_content()}{\_extract\_content()}}
{\footnotesize\ttfamily \label{classservices_1_1gpt__service_1_1_assistant_service_afad53fa4b4a6c12dfcb867993653d99e} 
\+\_\+extract\+\_\+content (\begin{DoxyParamCaption}\item[{}]{self}{, }\item[{}]{message}{}\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [protected]}}


\begin{DoxyCode}{0}
\DoxyCodeLine{00223\ \ \ \ \ \textcolor{keyword}{def\ }\_extract\_content(self,\ message):}
\DoxyCodeLine{00224\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ isinstance(message.content,\ list)\ \textcolor{keywordflow}{and}\ len(message.content)\ >\ 0:}
\DoxyCodeLine{00225\ \ \ \ \ \ \ \ \ \ \ \ \ content\_block\ =\ message.content[0]}
\DoxyCodeLine{00226\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ hasattr(content\_block,\ \textcolor{stringliteral}{'text'}):}
\DoxyCodeLine{00227\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ content\_block.text.value}
\DoxyCodeLine{00228\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ \textcolor{keywordtype}{None}}
\DoxyCodeLine{00229\ }
\DoxyCodeLine{00230\ }

\end{DoxyCode}
\Hypertarget{classservices_1_1gpt__service_1_1_assistant_service_a8683968d4e3145b6c20b2c3cca00edde}\index{AssistantService@{AssistantService}!completion@{completion}}
\index{completion@{completion}!AssistantService@{AssistantService}}
\doxysubsubsection{\texorpdfstring{completion()}{completion()}}
{\footnotesize\ttfamily \label{classservices_1_1gpt__service_1_1_assistant_service_a8683968d4e3145b6c20b2c3cca00edde} 
completion (\begin{DoxyParamCaption}\item[{}]{self}{, }\item[{str}]{text}{, }\item[{int}]{interaction\+\_\+count}{, }\item[{str }]{role}{ = {\ttfamily \textquotesingle{}user\textquotesingle{}}, }\item[{str }]{name}{ = {\ttfamily \textquotesingle{}user\textquotesingle{}}}\end{DoxyParamCaption})}



Reimplemented from \mbox{\hyperlink{classservices_1_1gpt__service_1_1_abstract_l_l_m_service_a8683968d4e3145b6c20b2c3cca00edde}{Abstract\+LLMService}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00175\ \ \ \ \ \textcolor{keyword}{async\ def\ }completion(self,\ text:\ str,\ interaction\_count:\ int,\ role:\ str\ =\ \textcolor{stringliteral}{'user'},\ name:\ str\ =\ \textcolor{stringliteral}{'user'}):}
\DoxyCodeLine{00176\ \ \ \ \ \ \ \ \ max\_retries\ =\ 3}
\DoxyCodeLine{00177\ \ \ \ \ \ \ \ \ retry\_delay\ =\ 5\ \ \textcolor{comment}{\#\ seconds}}
\DoxyCodeLine{00178\ }
\DoxyCodeLine{00179\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ attempt\ \textcolor{keywordflow}{in}\ range(max\_retries):}
\DoxyCodeLine{00180\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{00181\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Handle\ user\ input\ using\ inherited\ method\ from\ AssistantEventHandler}}
\DoxyCodeLine{00182\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ print(f\textcolor{stringliteral}{'getting\ user\ input\ for'})}
\DoxyCodeLine{00183\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ user\_input\ =\ await\ self.on\_user\_input(text,\ role,\ name)}
\DoxyCodeLine{00184\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.user\_context.append(user\_input)}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00186\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Create\ a\ new\ thread}}
\DoxyCodeLine{00187\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ thread\ =\ await\ self.on\_create\_thread(self.client)}
\DoxyCodeLine{00188\ }
\DoxyCodeLine{00189\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ Submit\ message\ and\ handle\ streaming\ response}}
\DoxyCodeLine{00190\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.handle\_streaming\_response(thread,\ text,\ interaction\_count)}
\DoxyCodeLine{00191\ }
\DoxyCodeLine{00192\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break}\ \ \textcolor{comment}{\#\ Exit\ loop\ if\ successful}}
\DoxyCodeLine{00193\ }
\DoxyCodeLine{00194\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{except}\ Exception\ \textcolor{keyword}{as}\ e:}
\DoxyCodeLine{00195\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ logger.error(f\textcolor{stringliteral}{"{}Error\ in\ AssistantService\ completion:\ \{str(e)\}"{}})}
\DoxyCodeLine{00196\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ attempt\ <\ max\_retries\ -\/\ 1:}
\DoxyCodeLine{00197\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ logger.info(f\textcolor{stringliteral}{"{}Retrying\ in\ \{retry\_delay\}\ seconds..."{}})}
\DoxyCodeLine{00198\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ await\ asyncio.sleep(retry\_delay)}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}:}
\DoxyCodeLine{00200\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ \ \textcolor{comment}{\#\ Re-\/raise\ the\ exception\ if\ all\ retries\ fail}}
\DoxyCodeLine{00201\ }

\end{DoxyCode}


References \mbox{\hyperlink{l00125}{Event\+Handler.\+client}}, \mbox{\hyperlink{l00158}{Assistant\+Service.\+client}}, \mbox{\hyperlink{l00042}{Transcription\+Service.\+client}}, \mbox{\hyperlink{l00160}{Deepgram\+TTS.\+client}}, \mbox{\hyperlink{l00203}{Assistant\+Service.\+handle\+\_\+streaming\+\_\+response()}}, \mbox{\hyperlink{l00013}{Call\+Context.\+user\+\_\+context}}, and \mbox{\hyperlink{l00035}{Abstract\+LLMService.\+user\+\_\+context}}.



Referenced by \mbox{\hyperlink{l00258}{Open\+AIService.\+completion()}}.

Here is the call graph for this function\+:
% FIG 4
Here is the caller graph for this function\+:
% FIG 5
\Hypertarget{classservices_1_1gpt__service_1_1_assistant_service_a7f68108596eb4781058bce5113e2469d}\index{AssistantService@{AssistantService}!create\_message@{create\_message}}
\index{create\_message@{create\_message}!AssistantService@{AssistantService}}
\doxysubsubsection{\texorpdfstring{create\_message()}{create\_message()}}
{\footnotesize\ttfamily \label{classservices_1_1gpt__service_1_1_assistant_service_a7f68108596eb4781058bce5113e2469d} 
create\+\_\+message (\begin{DoxyParamCaption}\item[{}]{client}{, }\item[{}]{thread}{, }\item[{}]{content}{, }\item[{}]{file}{ = {\ttfamily None}}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00164\ \ \ \ \ \textcolor{keyword}{def\ }create\_message(client,\ thread,\ content,\ file=None):}
\DoxyCodeLine{00165\ \ \ \ \ \ \ \ \ attachments\ =\ []}
\DoxyCodeLine{00166\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ file\ \textcolor{keywordflow}{is}\ \textcolor{keywordflow}{not}\ \textcolor{keywordtype}{None}:}
\DoxyCodeLine{00167\ \ \ \ \ \ \ \ \ \ \ \ \ attachments.append(}
\DoxyCodeLine{00168\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{\textcolor{stringliteral}{"{}file\_id"{}}:\ file.id,\ \textcolor{stringliteral}{"{}tools"{}}:\ [\{\textcolor{stringliteral}{"{}type"{}}:\ \textcolor{stringliteral}{"{}code\_interpreter"{}}\},\ \{\textcolor{stringliteral}{"{}type"{}}:\ \textcolor{stringliteral}{"{}file\_search"{}}\}]\}}
\DoxyCodeLine{00169\ \ \ \ \ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{00170\ \ \ \ \ \ \ \ \ client.beta.threads.messages.create(}
\DoxyCodeLine{00171\ \ \ \ \ \ \ \ \ \ \ \ \ thread\_id=thread.id,\ role=\textcolor{stringliteral}{"{}user"{}},\ content=content,\ attachments=attachments}
\DoxyCodeLine{00172\ \ \ \ \ \ \ \ \ )}
\DoxyCodeLine{00173\ }

\end{DoxyCode}
\Hypertarget{classservices_1_1gpt__service_1_1_assistant_service_a132be0108441bc7573d3a632b2e24eeb}\index{AssistantService@{AssistantService}!create\_thread@{create\_thread}}
\index{create\_thread@{create\_thread}!AssistantService@{AssistantService}}
\doxysubsubsection{\texorpdfstring{create\_thread()}{create\_thread()}}
{\footnotesize\ttfamily \label{classservices_1_1gpt__service_1_1_assistant_service_a132be0108441bc7573d3a632b2e24eeb} 
create\+\_\+thread (\begin{DoxyParamCaption}\item[{}]{client}{, }\item[{}]{content}{, }\item[{}]{file}{ = {\ttfamily None}}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00161\ \ \ \ \ \textcolor{keyword}{def\ }create\_thread(client,\ content,\ file=None):}
\DoxyCodeLine{00162\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ client.beta.threads.create()}
\DoxyCodeLine{00163\ }

\end{DoxyCode}
\Hypertarget{classservices_1_1gpt__service_1_1_assistant_service_a550a9c984b3b99a65e29c54b42482549}\index{AssistantService@{AssistantService}!handle\_streaming\_response@{handle\_streaming\_response}}
\index{handle\_streaming\_response@{handle\_streaming\_response}!AssistantService@{AssistantService}}
\doxysubsubsection{\texorpdfstring{handle\_streaming\_response()}{handle\_streaming\_response()}}
{\footnotesize\ttfamily \label{classservices_1_1gpt__service_1_1_assistant_service_a550a9c984b3b99a65e29c54b42482549} 
handle\+\_\+streaming\+\_\+response (\begin{DoxyParamCaption}\item[{}]{self}{, }\item[{}]{thread}{, }\item[{}]{text}{, }\item[{}]{interaction\+\_\+count}{}\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{00203\ \ \ \ \ \textcolor{keyword}{def\ }handle\_streaming\_response(self,\ thread,\ text,\ interaction\_count):}
\DoxyCodeLine{00204\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{try}:}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \ \ \ \ event\_handler\ =\ AssistantEventHandler()}
\DoxyCodeLine{00206\ }
\DoxyCodeLine{00207\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{with}\ self.client.beta.threads.runs.stream(}
\DoxyCodeLine{00208\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ thread\_id=thread.id,}
\DoxyCodeLine{00209\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ assistant\_id=self.assistant\_id,}
\DoxyCodeLine{00210\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ instructions=\textcolor{stringliteral}{"{}Please\ address\ the\ user\ as\ Jane\ Doe.\ The\ user\ has\ a\ premium\ account."{}},}
\DoxyCodeLine{00211\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ event\_handler=event\_handler}
\DoxyCodeLine{00212\ \ \ \ \ \ \ \ \ \ \ \ \ )\ \textcolor{keyword}{as}\ stream:}
\DoxyCodeLine{00213\ }
\DoxyCodeLine{00214\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ final\_response\ =\ event\_handler.get\_responses()}
\DoxyCodeLine{00215\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ self.emit\_complete\_sentences(final\_response,\ interaction\_count)}
\DoxyCodeLine{00216\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{\#\ After\ streaming,\ process\ the\ collected\ responses}}
\DoxyCodeLine{00217\ }
\DoxyCodeLine{00218\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{except}\ Exception\ \textcolor{keyword}{as}\ e:}
\DoxyCodeLine{00219\ \ \ \ \ \ \ \ \ \ \ \ \ logger.error(f\textcolor{stringliteral}{"{}Error\ in\ handle\_streaming\_response:\ \{str(e)\}"{}})}
\DoxyCodeLine{00220\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{raise}\ e}
\DoxyCodeLine{00221\ }

\end{DoxyCode}


References \mbox{\hyperlink{l00159}{Assistant\+Service.\+assistant\+\_\+id}}, \mbox{\hyperlink{l00125}{Event\+Handler.\+client}}, \mbox{\hyperlink{l00158}{Assistant\+Service.\+client}}, \mbox{\hyperlink{l00042}{Transcription\+Service.\+client}}, \mbox{\hyperlink{l00160}{Deepgram\+TTS.\+client}}, and \mbox{\hyperlink{l00082}{Abstract\+LLMService.\+emit\+\_\+complete\+\_\+sentences()}}.



Referenced by \mbox{\hyperlink{l00175}{Assistant\+Service.\+completion()}}.

Here is the call graph for this function\+:
% FIG 6
Here is the caller graph for this function\+:
% FIG 7


\doxysubsection{Field Documentation}
\Hypertarget{classservices_1_1gpt__service_1_1_assistant_service_a991e3bc52840f1bd0bf37b0894dd803d}\index{AssistantService@{AssistantService}!assistant\_id@{assistant\_id}}
\index{assistant\_id@{assistant\_id}!AssistantService@{AssistantService}}
\doxysubsubsection{\texorpdfstring{assistant\_id}{assistant\_id}}
{\footnotesize\ttfamily \label{classservices_1_1gpt__service_1_1_assistant_service_a991e3bc52840f1bd0bf37b0894dd803d} 
assistant\+\_\+id = os.\+getenv("{}ASSISTANT\+\_\+\+ID"{})}



Referenced by \mbox{\hyperlink{l00203}{Assistant\+Service.\+handle\+\_\+streaming\+\_\+response()}}.

\Hypertarget{classservices_1_1gpt__service_1_1_assistant_service_ad5bc32b75da65fe60067f501a4bb6665}\index{AssistantService@{AssistantService}!client@{client}}
\index{client@{client}!AssistantService@{AssistantService}}
\doxysubsubsection{\texorpdfstring{client}{client}}
{\footnotesize\ttfamily \label{classservices_1_1gpt__service_1_1_assistant_service_ad5bc32b75da65fe60067f501a4bb6665} 
client = Open\+AI(api\+\_\+key=os.\+getenv("{}OPENAI\+\_\+\+API\+\_\+\+KEY"{}))}



Referenced by \mbox{\hyperlink{l00175}{Assistant\+Service.\+completion()}}, \mbox{\hyperlink{l00162}{Deepgram\+TTS.\+generate()}}, \mbox{\hyperlink{l00203}{Assistant\+Service.\+handle\+\_\+streaming\+\_\+response()}}, \mbox{\hyperlink{l00145}{Event\+Handler.\+on\+\_\+text\+\_\+done()}}, and \mbox{\hyperlink{l00196}{Event\+Handler.\+submit\+\_\+tool\+\_\+outputs()}}.

\Hypertarget{classservices_1_1gpt__service_1_1_assistant_service_a7ea94dfe4b4adb87b01c5ecfb01781ef}\index{AssistantService@{AssistantService}!openai@{openai}}
\index{openai@{openai}!AssistantService@{AssistantService}}
\doxysubsubsection{\texorpdfstring{openai}{openai}}
{\footnotesize\ttfamily \label{classservices_1_1gpt__service_1_1_assistant_service_a7ea94dfe4b4adb87b01c5ecfb01781ef} 
openai = Async\+Open\+AI(api\+\_\+key=os.\+getenv("{}OPENAI\+\_\+\+API\+\_\+\+KEY"{}))}



Referenced by \mbox{\hyperlink{l00258}{Open\+AIService.\+completion()}}.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
/\+Users/seanbaker/\+Downloads/\+GPTPhone (2)/services/\mbox{\hyperlink{gpt__service_8py}{gpt\+\_\+service.\+py}}\end{DoxyCompactItemize}
