<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>GPTPHONE: /Users/seanbaker/Downloads/GPTPhone (2)/Assistants.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">GPTPHONE
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('_assistants_8py_source.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">Assistants.py</div></div>
</div><!--header-->
<div class="contents">
<a href="_assistants_8py.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno"><a class="line" href="namespace_assistants.html">    1</a></span><span class="keyword">import</span> os</div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="keyword">import</span> base64</div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="keyword">import</span> re</div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="keyword">import</span> json</div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="keyword">import</span> openai</div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="keyword">from</span> tools <span class="keyword">import</span> TOOL_MAP</div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="keyword">from</span> typing_extensions <span class="keyword">import</span> override</div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="keyword">from</span> dotenv <span class="keyword">import</span> load_dotenv</div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="keyword">from</span> Utils.logger_config <span class="keyword">import</span> get_logger,log_function_call</div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span>load_dotenv()</div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno"><a class="line" href="namespace_assistants.html#af8d4f84f784fdbae10c34ca90ae65081">   11</a></span>logger = get_logger(__name__)</div>
<div class="foldopen" id="foldopen00012" data-start="" data-end="">
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno"><a class="line" href="namespace_assistants.html#a3df180ad7a5b59c360c5e04c460169c1">   12</a></span><span class="keyword">def </span><a class="code hl_function" href="namespace_assistants.html#a3df180ad7a5b59c360c5e04c460169c1">str_to_bool</a>(str_input):</div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="stringliteral">    Convert a string to a boolean value.</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="stringliteral">    :param str_input: The string to convert.</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="stringliteral">    :return: The boolean value converted from the string.</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span>    <span class="keywordflow">if</span> <span class="keywordflow">not</span> isinstance(str_input, str):</div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span>        <span class="keywordflow">return</span> <span class="keyword">False</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span>    <span class="keywordflow">return</span> str_input.lower() == <span class="stringliteral">&quot;true&quot;</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span> </div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span> </div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="comment"># Load environment variables</span></div>
</div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno"><a class="line" href="namespace_assistants.html#a07bb36926594da6badcae9596f3f471b">   25</a></span>openai_api_key = os.environ.get(<span class="stringliteral">&quot;OPENAI_API_KEY&quot;</span>)</div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno"><a class="line" href="namespace_assistants.html#a8278c6d7ed4dfcadd23823b5c092beb8">   26</a></span>azure_openai_endpoint = os.environ.get(<span class="stringliteral">&quot;AZURE_OPENAI_ENDPOINT&quot;</span>)</div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno"><a class="line" href="namespace_assistants.html#a013993841daebf0fb546bfe7faa318b9">   27</a></span>azure_openai_key = os.environ.get(<span class="stringliteral">&quot;AZURE_OPENAI_KEY&quot;</span>)</div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span> </div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno"><a class="line" href="namespace_assistants.html#a88596fcaa85b3133e2399f5a80c7d9a3">   29</a></span>client = <span class="keywordtype">None</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="keywordflow">if</span> azure_openai_endpoint <span class="keywordflow">and</span> azure_openai_key:</div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span>    client = openai.AzureOpenAI(</div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span>        api_key=azure_openai_key,</div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span>        api_version=<span class="stringliteral">&quot;2024-05-01-preview&quot;</span>,</div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span>        azure_endpoint=azure_openai_endpoint,</div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span>    )</div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span><span class="keywordflow">else</span>:</div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>    client = openai.OpenAI(api_key=openai_api_key)</div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span> </div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span> </div>
<div class="foldopen" id="foldopen00040" data-start="" data-end="">
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno"><a class="line" href="class_assistants_1_1_event_handler.html">   40</a></span><span class="keyword">class </span><a class="code hl_class" href="class_assistants_1_1_event_handler.html">EventHandler</a>(openai.AssistantEventHandler):</div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span><span class="stringliteral">    Class EventHandler</span></div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span><span class="stringliteral">    This class is a subclass of the openai.AssistantEventHandler class and contains various methods that handle different events related to the OpenAI Assistant.</span></div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span><span class="stringliteral">    Attributes:</span></div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span><span class="stringliteral">    - session_state (dict): A dictionary that stores the current state of the session, including chat log, tool calls, current message, current markdown, current tool input, and current tool input markdown.</span></div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span><span class="stringliteral">    Methods:</span></div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span><span class="stringliteral">    - on_event(event): Handles the general event. This method is not implemented in the EventHandler class and needs to be overridden in a subclass.</span></div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span><span class="stringliteral">    - on_text_created(text): Handles the event when a new text is created. It sets the current message to empty and prints &quot;Assistant:&quot;.</span></div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span><span class="stringliteral">    - on_text_delta(delta, snapshot): Handles the event when a delta change is made to the text. It updates the current message in the session state and prints the updated text.</span></div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span><span class="stringliteral">    - on_text_done(text): Handles the event when the text is complete. It formats the annotation in the text, prints the formatted text, and appends it to the chat log in the session state.</span></div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span><span class="stringliteral">    - on_tool_call_created(tool_call): Handles the event when a tool call is created. If the tool call is of type &quot;code_interpreter&quot;, it sets the current tool input to empty and prints &quot;Assistant:&quot;.</span></div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span><span class="stringliteral">    - on_tool_call_delta(delta, snapshot): Handles the event when a delta change is made to the tool call. If the delta is of type &quot;code_interpreter&quot;, it updates the current tool input in the session state and prints the input code.</span></div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span><span class="stringliteral">    - on_tool_call_done(tool_call): Handles the event when the tool call is complete. It appends the tool call to the tool calls list in the session state. If the tool call is of type &quot;code_interpreter&quot;, it prints the input code and outputs.</span></div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span><span class="stringliteral">    - format_annotation(text): Formats the annotation in the given text by replacing annotation texts with numbered references and creating download links for file citations. Returns the formatted text.</span></div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span><span class="stringliteral">    - create_file_link(file_name, file_id): Creates a download link for the given file name and file ID. Returns the link tag.</span></div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span><span class="stringliteral">    Note: This class needs to be subclassed and the on_event() method needs to be implemented in the subclass.</span></div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="foldopen" id="foldopen00064" data-start="" data-end="">
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno"><a class="line" href="class_assistants_1_1_event_handler.html#a18fd46d4b4e4c9aabbf6f266d8e55828">   64</a></span>    <span class="keyword">def </span><a class="code hl_function" href="class_assistants_1_1_event_handler.html#a18fd46d4b4e4c9aabbf6f266d8e55828">__init__</a>(self):</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span> </div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>        super().<a class="code hl_function" href="class_assistants_1_1_event_handler.html#a18fd46d4b4e4c9aabbf6f266d8e55828">__init__</a>()</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno"><a class="line" href="class_assistants_1_1_event_handler.html#a84732a1a8c66e0895dddb44eeea9ad62">   67</a></span>        self.<a class="code hl_variable" href="class_assistants_1_1_event_handler.html#a84732a1a8c66e0895dddb44eeea9ad62">session_state</a> = {</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>            <span class="stringliteral">&quot;chat_log&quot;</span>: [],</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>            <span class="stringliteral">&quot;tool_calls&quot;</span>: [],</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>            <span class="stringliteral">&quot;current_message&quot;</span>: <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>            <span class="stringliteral">&quot;current_markdown&quot;</span>: <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>            <span class="stringliteral">&quot;current_tool_input&quot;</span>: <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>            <span class="stringliteral">&quot;current_tool_input_markdown&quot;</span>: <span class="stringliteral">&quot;&quot;</span></div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>        }</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span> </div>
</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>    <span class="preprocessor">@override</span></div>
<div class="foldopen" id="foldopen00077" data-start="" data-end="">
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno"><a class="line" href="class_assistants_1_1_event_handler.html#ae91962de43c8526db76f5da35baaf237">   77</a></span>    <span class="keyword">def </span><a class="code hl_function" href="class_assistants_1_1_event_handler.html#ae91962de43c8526db76f5da35baaf237">on_event</a>(self, event):</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>        <span class="keywordflow">pass</span></div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span> </div>
</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>    <span class="preprocessor">@override</span></div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>    <span class="preprocessor">@log_function_call</span></div>
<div class="foldopen" id="foldopen00082" data-start="" data-end="">
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno"><a class="line" href="class_assistants_1_1_event_handler.html#a92727d3ca510eb9ede79aa08db448681">   82</a></span>    <span class="keyword">def </span><a class="code hl_function" href="class_assistants_1_1_event_handler.html#a92727d3ca510eb9ede79aa08db448681">on_text_created</a>(self, text):</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>        self.<a class="code hl_variable" href="class_assistants_1_1_event_handler.html#a84732a1a8c66e0895dddb44eeea9ad62">session_state</a>[<span class="stringliteral">&quot;current_message&quot;</span>] = <span class="stringliteral">&quot;&quot;</span></div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>        print(<span class="stringliteral">&quot;Assistant:&quot;</span>)</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span> </div>
</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>    <span class="preprocessor">@override</span></div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>    <span class="preprocessor">@log_function_call</span></div>
<div class="foldopen" id="foldopen00088" data-start="" data-end="">
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno"><a class="line" href="class_assistants_1_1_event_handler.html#a1295eb20f4253f8d7b1feb0fbed20a57">   88</a></span>    <span class="keyword">def </span><a class="code hl_function" href="class_assistants_1_1_event_handler.html#a1295eb20f4253f8d7b1feb0fbed20a57">on_text_delta</a>(self, delta, snapshot):</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>        <span class="keywordflow">if</span> snapshot.value:</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>            text_value = re.sub(</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>                <span class="stringliteral">r&quot;\[(.*?)\]\s*\&zwj;(\s*(.*?)\s*\&zwj;)&quot;</span>, <span class="stringliteral">&quot;Download Link&quot;</span>, snapshot.value</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>            )</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>            self.<a class="code hl_variable" href="class_assistants_1_1_event_handler.html#a84732a1a8c66e0895dddb44eeea9ad62">session_state</a>[<span class="stringliteral">&quot;current_message&quot;</span>] = text_value</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>            print(text_value, end=<span class="stringliteral">&quot;&quot;</span>, flush=<span class="keyword">True</span>)</div>
</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>    <span class="preprocessor">@log_function_call</span></div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>    <span class="preprocessor">@override</span></div>
<div class="foldopen" id="foldopen00097" data-start="" data-end="">
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno"><a class="line" href="class_assistants_1_1_event_handler.html#acf640b9993efe169d237d0e2d180bbb0">   97</a></span>    <span class="keyword">def </span><a class="code hl_function" href="class_assistants_1_1_event_handler.html#acf640b9993efe169d237d0e2d180bbb0">on_text_done</a>(self, text):</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>        format_text = self.<a class="code hl_function" href="class_assistants_1_1_event_handler.html#ab5d0ae325a0eab3a63e84447a384aa03">format_annotation</a>(text)</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>        print(<span class="stringliteral">&quot;\n&quot;</span> + format_text)</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>        self.<a class="code hl_variable" href="class_assistants_1_1_event_handler.html#a84732a1a8c66e0895dddb44eeea9ad62">session_state</a>[<span class="stringliteral">&quot;chat_log&quot;</span>].append({<span class="stringliteral">&quot;name&quot;</span>: <span class="stringliteral">&quot;assistant&quot;</span>, <span class="stringliteral">&quot;msg&quot;</span>: format_text})</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span> </div>
</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>    <span class="preprocessor">@override</span></div>
<div class="foldopen" id="foldopen00103" data-start="" data-end="">
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno"><a class="line" href="class_assistants_1_1_event_handler.html#ab0571091424e1dc3cc9b87e7516bb7de">  103</a></span>    <span class="keyword">def </span><a class="code hl_function" href="class_assistants_1_1_event_handler.html#ab0571091424e1dc3cc9b87e7516bb7de">on_tool_call_created</a>(self, tool_call):</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>        <span class="keywordflow">if</span> tool_call.type == <span class="stringliteral">&quot;code_interpreter&quot;</span>:</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>            self.<a class="code hl_variable" href="class_assistants_1_1_event_handler.html#a84732a1a8c66e0895dddb44eeea9ad62">session_state</a>[<span class="stringliteral">&quot;current_tool_input&quot;</span>] = <span class="stringliteral">&quot;&quot;</span></div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>            print(<span class="stringliteral">&quot;Assistant:&quot;</span>)</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span> </div>
</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>    <span class="preprocessor">@override</span></div>
<div class="foldopen" id="foldopen00109" data-start="" data-end="">
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno"><a class="line" href="class_assistants_1_1_event_handler.html#a4185efc1c68145cefeacf2da98ecb200">  109</a></span>    <span class="keyword">def </span><a class="code hl_function" href="class_assistants_1_1_event_handler.html#a4185efc1c68145cefeacf2da98ecb200">on_tool_call_delta</a>(self, delta, snapshot):</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>        <span class="keywordflow">if</span> delta.type == <span class="stringliteral">&quot;code_interpreter&quot;</span>:</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>            <span class="keywordflow">if</span> delta.code_interpreter.input:</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>                self.<a class="code hl_variable" href="class_assistants_1_1_event_handler.html#a84732a1a8c66e0895dddb44eeea9ad62">session_state</a>[<span class="stringliteral">&quot;current_tool_input&quot;</span>] += delta.code_interpreter.input</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>                input_code = f<span class="stringliteral">&quot;### code interpreter\ninput:\n```python\n{self.session_state[&#39;current_tool_input&#39;]}\n```&quot;</span></div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>                print(input_code, end=<span class="stringliteral">&quot;&quot;</span>, flush=<span class="keyword">True</span>)</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span> </div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>            <span class="keywordflow">if</span> delta.code_interpreter.outputs:</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>                <span class="keywordflow">for</span> output <span class="keywordflow">in</span> delta.code_interpreter.outputs:</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>                    <span class="keywordflow">if</span> output.type == <span class="stringliteral">&quot;logs&quot;</span>:</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>                        <span class="keywordflow">pass</span></div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span> </div>
</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>    <span class="preprocessor">@override</span></div>
<div class="foldopen" id="foldopen00122" data-start="" data-end="">
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno"><a class="line" href="class_assistants_1_1_event_handler.html#adbc2ebd7e16dbd2e6948507d5f09485e">  122</a></span>    <span class="keyword">def </span><a class="code hl_function" href="class_assistants_1_1_event_handler.html#adbc2ebd7e16dbd2e6948507d5f09485e">on_tool_call_done</a>(self, tool_call):</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>        self.<a class="code hl_variable" href="class_assistants_1_1_event_handler.html#a84732a1a8c66e0895dddb44eeea9ad62">session_state</a>[<span class="stringliteral">&quot;tool_calls&quot;</span>].append(tool_call)</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>        <span class="keywordflow">if</span> tool_call.type == <span class="stringliteral">&quot;code_interpreter&quot;</span>:</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>            input_code = f<span class="stringliteral">&quot;### code interpreter\ninput:\n```python\n{tool_call.code_interpreter.input}\n```&quot;</span></div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>            print(input_code)</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>            <span class="keywordflow">for</span> output <span class="keywordflow">in</span> tool_call.code_interpreter.outputs:</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>                <span class="keywordflow">if</span> output.type == <span class="stringliteral">&quot;logs&quot;</span>:</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>                    output = f<span class="stringliteral">&quot;### code interpreter\noutput:\n```\n{output.logs}\n```&quot;</span></div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>                    print(output)</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span> </div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>        <span class="keywordflow">elif</span> (</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>                tool_call.type == <span class="stringliteral">&quot;function&quot;</span></div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>                <span class="keywordflow">and</span> self.current_run.status == <span class="stringliteral">&quot;requires_action&quot;</span></div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>        ):</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>            msg = f<span class="stringliteral">&quot;### Function Calling: {tool_call.function.name}&quot;</span></div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>            print(msg)</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>            self.<a class="code hl_variable" href="class_assistants_1_1_event_handler.html#a84732a1a8c66e0895dddb44eeea9ad62">session_state</a>[<span class="stringliteral">&quot;chat_log&quot;</span>].append({<span class="stringliteral">&quot;name&quot;</span>: <span class="stringliteral">&quot;assistant&quot;</span>, <span class="stringliteral">&quot;msg&quot;</span>: msg})</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>            tool_calls = self.current_run.required_action.submit_tool_outputs.tool_calls</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>            tool_outputs = []</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>            <span class="keywordflow">for</span> submit_tool_call <span class="keywordflow">in</span> tool_calls:</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>                tool_function_name = submit_tool_call.function.name</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>                tool_function_arguments = json.loads(</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>                    submit_tool_call.function.arguments</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>                )</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>                tool_function_output = TOOL_MAP[tool_function_name](</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>                    **tool_function_arguments</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>                )</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>                tool_outputs.append(</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>                    {</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>                        <span class="stringliteral">&quot;tool_call_id&quot;</span>: submit_tool_call.id,</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>                        <span class="stringliteral">&quot;output&quot;</span>: tool_function_output,</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>                    }</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>                )</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span> </div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>            <span class="keyword">with</span> client.beta.threads.runs.submit_tool_outputs_stream(</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>                    thread_id=thread.id,</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>                    run_id=self.current_run.id,</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>                    tool_outputs=tool_outputs,</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>                    event_handler=<a class="code hl_class" href="class_assistants_1_1_event_handler.html">EventHandler</a>(),</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>            ) <span class="keyword">as</span> stream:</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>                stream.until_done()</div>
</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>    <span class="preprocessor">@log_function_call</span></div>
<div class="foldopen" id="foldopen00164" data-start="" data-end="">
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno"><a class="line" href="class_assistants_1_1_event_handler.html#ab5d0ae325a0eab3a63e84447a384aa03">  164</a></span>    <span class="keyword">def </span><a class="code hl_function" href="class_assistants_1_1_event_handler.html#ab5d0ae325a0eab3a63e84447a384aa03">format_annotation</a>(self, text):</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>        citations = []</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>        text_value = text.value</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>        <span class="keywordflow">for</span> index, annotation <span class="keywordflow">in</span> enumerate(text.annotations):</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>            text_value = text_value.replace(annotation.text, f<span class="stringliteral">&quot; [{index}]&quot;</span>)</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span> </div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>            <span class="keywordflow">if</span> file_citation := getattr(annotation, <span class="stringliteral">&quot;file_citation&quot;</span>, <span class="keywordtype">None</span>):</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>                cited_file = client.files.retrieve(file_citation.file_id)</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>                citations.append(</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>                    f<span class="stringliteral">&quot;[{index}] {file_citation.quote} from {cited_file.filename}&quot;</span></div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>                )</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>            <span class="keywordflow">elif</span> file_path := getattr(annotation, <span class="stringliteral">&quot;file_path&quot;</span>, <span class="keywordtype">None</span>):</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>                link_tag = self.<a class="code hl_function" href="class_assistants_1_1_event_handler.html#af45ca7cb36b12473ed39b4fb4e5c4b4f">create_file_link</a>(</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>                    annotation.text.split(<span class="stringliteral">&quot;/&quot;</span>)[-1],</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>                    file_path.file_id,</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>                )</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>                text_value = re.sub(<span class="stringliteral">r&quot;\[(.*?)\]\s*\&zwj;(\s*(.*?)\s*\&zwj;)&quot;</span>, link_tag, text_value)</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>        text_value += <span class="stringliteral">&quot;\n\n&quot;</span> + <span class="stringliteral">&quot;\n&quot;</span>.join(citations)</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>        <span class="keywordflow">return</span> text_value</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span> </div>
</div>
<div class="foldopen" id="foldopen00184" data-start="" data-end="">
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno"><a class="line" href="class_assistants_1_1_event_handler.html#af45ca7cb36b12473ed39b4fb4e5c4b4f">  184</a></span>    <span class="keyword">def </span><a class="code hl_function" href="class_assistants_1_1_event_handler.html#af45ca7cb36b12473ed39b4fb4e5c4b4f">create_file_link</a>(self, file_name, file_id):</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>        content = client.files.content(file_id)</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>        content_type = content.response.headers[<span class="stringliteral">&quot;content-type&quot;</span>]</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>        b64 = base64.b64encode(content.text.encode(content.encoding)).decode()</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>        link_tag = f<span class="stringliteral">&#39;&lt;a href=&quot;data:{content_type};base64,{b64}&quot; download=&quot;{file_name}&quot;&gt;Download Link&lt;/a&gt;&#39;</span></div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>        <span class="keywordflow">return</span> link_tag</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span> </div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span><span class="preprocessor">@log_function_call</span></div>
</div>
</div>
<div class="foldopen" id="foldopen00192" data-start="" data-end="">
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno"><a class="line" href="namespace_assistants.html#aff202743350df09a7bde370deb710c29">  192</a></span><span class="keyword">def </span><a class="code hl_function" href="namespace_assistants.html#aff202743350df09a7bde370deb710c29">create_thread</a>(content, file):</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span><span class="stringliteral">    :param content: The content of the thread.</span></div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span><span class="stringliteral">    :param file: The file associated with the thread.</span></div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span><span class="stringliteral">    :return: The created thread.</span></div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>    <span class="keywordflow">return</span> client.beta.threads.create()</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span> </div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span><span class="preprocessor">@log_function_call</span></div>
</div>
<div class="foldopen" id="foldopen00203" data-start="" data-end="">
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno"><a class="line" href="namespace_assistants.html#a0a5d3f62216b341f7d7cc8895f486cbe">  203</a></span><span class="keyword">def </span><a class="code hl_function" href="namespace_assistants.html#a0a5d3f62216b341f7d7cc8895f486cbe">create_message</a>(thread, content, file):</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span><span class="stringliteral">    :param thread: A Thread object representing the thread where the message will be created.</span></div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span><span class="stringliteral">    :param content: A string representing the content of the message.</span></div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span><span class="stringliteral">    :param file: An optional File object representing a file attachment for the message.</span></div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span><span class="stringliteral">    :return: None</span></div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span><span class="stringliteral">    This method creates a message in a given thread using the provided content and file attachment, if any. If a file attachment is provided, it is added to the message as an attachment with specific tools associated with it. The message is created using the client.beta.threads.messages.create() method, specifying the thread id, role, content, and attachments parameters.</span></div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>    attachments = []</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>    <span class="keywordflow">if</span> file <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>        attachments.append(</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>            {<span class="stringliteral">&quot;file_id&quot;</span>: file.id, <span class="stringliteral">&quot;tools&quot;</span>: [{<span class="stringliteral">&quot;type&quot;</span>: <span class="stringliteral">&quot;code_interpreter&quot;</span>}, {<span class="stringliteral">&quot;type&quot;</span>: <span class="stringliteral">&quot;file_search&quot;</span>}]}</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>        )</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>    client.beta.threads.messages.create(</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>        thread_id=thread.id, role=<span class="stringliteral">&quot;user&quot;</span>, content=content, attachments=attachments</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>    )</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span> </div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span><span class="preprocessor">@log_function_call</span></div>
</div>
<div class="foldopen" id="foldopen00222" data-start="" data-end="">
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno"><a class="line" href="namespace_assistants.html#a7e06d04d97c10c38236400d7bb3f7c15">  222</a></span><span class="keyword">def </span><a class="code hl_function" href="namespace_assistants.html#a7e06d04d97c10c38236400d7bb3f7c15">run_stream</a>(user_input, file, selected_assistant_id):</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span><span class="stringliteral">    :param user_input: The input from the user.</span></div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span><span class="stringliteral">    :param file: The file to be processed.</span></div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span><span class="stringliteral">    :param selected_assistant_id: The ID of the selected assistant.</span></div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span><span class="stringliteral">    :return: None</span></div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span><span class="stringliteral">    This method runs a stream for a chat session using the given user input, file, and selected assistant ID. It creates a thread, sends messages to the thread, and handles events using the event handler. The chat log is printed at the end of the session.</span></div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>    thread = <a class="code hl_function" href="namespace_assistants.html#aff202743350df09a7bde370deb710c29">create_thread</a>(user_input, file)</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>    <a class="code hl_function" href="namespace_assistants.html#a0a5d3f62216b341f7d7cc8895f486cbe">create_message</a>(thread, user_input, file)</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>    event_handler = <a class="code hl_class" href="class_assistants_1_1_event_handler.html">EventHandler</a>()  <span class="comment"># Create an instance of the event handler with session state</span></div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>    <span class="keyword">with</span> client.beta.threads.runs.stream(</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>            thread_id=thread.id,</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>            assistant_id=selected_assistant_id,</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>            event_handler=event_handler,</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>    ) <span class="keyword">as</span> stream:</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>        stream.until_done()</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span> </div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>    <span class="comment"># Access the session state from the event handler if needed</span></div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>    session_state = event_handler.session_state</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>    print(<span class="stringliteral">&quot;\nFinal Chat Log:&quot;</span>)</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>    <span class="keywordflow">for</span> log <span class="keywordflow">in</span> session_state[<span class="stringliteral">&quot;chat_log&quot;</span>]:</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>        print(f<span class="stringliteral">&quot;{log[&#39;name&#39;]}: {log[&#39;msg&#39;]}&quot;</span>)</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span> </div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span> </div>
</div>
<div class="foldopen" id="foldopen00248" data-start="" data-end="">
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno"><a class="line" href="namespace_assistants.html#abb2e1b5dbeb417a174f49b522a1b1e99">  248</a></span><span class="keyword">def </span><a class="code hl_function" href="namespace_assistants.html#abb2e1b5dbeb417a174f49b522a1b1e99">main</a>():</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>    <span class="stringliteral">&quot;&quot;&quot;</span></div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span><span class="stringliteral">    Entry point for the program.</span></div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span><span class="stringliteral"></span> </div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span><span class="stringliteral">    :return: None</span></div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span><span class="stringliteral">    &quot;&quot;&quot;</span></div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>    <span class="comment"># Simulate user input and assistant interaction</span></div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>    user_input = input(<span class="stringliteral">&quot;You: &quot;</span>)</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>    assistant_id = os.environ.get(<span class="stringliteral">&quot;ASSISTANT_ID&quot;</span>, <span class="stringliteral">&quot;default_assistant&quot;</span>)</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span> </div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>    <span class="comment"># Simulate a file upload (disabled in this example)</span></div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>    uploaded_file = <span class="keywordtype">None</span></div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span> </div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>    <span class="comment"># Run the stream</span></div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>    <span class="keywordflow">while</span> user_input != <span class="stringliteral">&quot;q&quot;</span>:</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>        <a class="code hl_function" href="namespace_assistants.html#a7e06d04d97c10c38236400d7bb3f7c15">run_stream</a>(user_input, uploaded_file, assistant_id)</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>        user_input = input(<span class="stringliteral">&quot;You: &quot;</span>)</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span> </div>
</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span><span class="keywordflow">if</span> __name__ == <span class="stringliteral">&quot;__main__&quot;</span>:</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>    <a class="code hl_function" href="namespace_assistants.html#abb2e1b5dbeb417a174f49b522a1b1e99">main</a>()</div>
<div class="ttc" id="aclass_assistants_1_1_event_handler_html"><div class="ttname"><a href="class_assistants_1_1_event_handler.html">Assistants.EventHandler</a></div><div class="ttdef"><b>Definition</b> <a href="#l00040">Assistants.py:40</a></div></div>
<div class="ttc" id="aclass_assistants_1_1_event_handler_html_a1295eb20f4253f8d7b1feb0fbed20a57"><div class="ttname"><a href="class_assistants_1_1_event_handler.html#a1295eb20f4253f8d7b1feb0fbed20a57">Assistants.EventHandler.on_text_delta</a></div><div class="ttdeci">on_text_delta(self, delta, snapshot)</div><div class="ttdef"><b>Definition</b> <a href="#l00088">Assistants.py:88</a></div></div>
<div class="ttc" id="aclass_assistants_1_1_event_handler_html_a18fd46d4b4e4c9aabbf6f266d8e55828"><div class="ttname"><a href="class_assistants_1_1_event_handler.html#a18fd46d4b4e4c9aabbf6f266d8e55828">Assistants.EventHandler.__init__</a></div><div class="ttdeci">__init__(self)</div><div class="ttdef"><b>Definition</b> <a href="#l00064">Assistants.py:64</a></div></div>
<div class="ttc" id="aclass_assistants_1_1_event_handler_html_a4185efc1c68145cefeacf2da98ecb200"><div class="ttname"><a href="class_assistants_1_1_event_handler.html#a4185efc1c68145cefeacf2da98ecb200">Assistants.EventHandler.on_tool_call_delta</a></div><div class="ttdeci">on_tool_call_delta(self, delta, snapshot)</div><div class="ttdef"><b>Definition</b> <a href="#l00109">Assistants.py:109</a></div></div>
<div class="ttc" id="aclass_assistants_1_1_event_handler_html_a84732a1a8c66e0895dddb44eeea9ad62"><div class="ttname"><a href="class_assistants_1_1_event_handler.html#a84732a1a8c66e0895dddb44eeea9ad62">Assistants.EventHandler.session_state</a></div><div class="ttdeci">dict session_state</div><div class="ttdef"><b>Definition</b> <a href="#l00067">Assistants.py:67</a></div></div>
<div class="ttc" id="aclass_assistants_1_1_event_handler_html_a92727d3ca510eb9ede79aa08db448681"><div class="ttname"><a href="class_assistants_1_1_event_handler.html#a92727d3ca510eb9ede79aa08db448681">Assistants.EventHandler.on_text_created</a></div><div class="ttdeci">on_text_created(self, text)</div><div class="ttdef"><b>Definition</b> <a href="#l00082">Assistants.py:82</a></div></div>
<div class="ttc" id="aclass_assistants_1_1_event_handler_html_ab0571091424e1dc3cc9b87e7516bb7de"><div class="ttname"><a href="class_assistants_1_1_event_handler.html#ab0571091424e1dc3cc9b87e7516bb7de">Assistants.EventHandler.on_tool_call_created</a></div><div class="ttdeci">on_tool_call_created(self, tool_call)</div><div class="ttdef"><b>Definition</b> <a href="#l00103">Assistants.py:103</a></div></div>
<div class="ttc" id="aclass_assistants_1_1_event_handler_html_ab5d0ae325a0eab3a63e84447a384aa03"><div class="ttname"><a href="class_assistants_1_1_event_handler.html#ab5d0ae325a0eab3a63e84447a384aa03">Assistants.EventHandler.format_annotation</a></div><div class="ttdeci">format_annotation(self, text)</div><div class="ttdef"><b>Definition</b> <a href="#l00164">Assistants.py:164</a></div></div>
<div class="ttc" id="aclass_assistants_1_1_event_handler_html_acf640b9993efe169d237d0e2d180bbb0"><div class="ttname"><a href="class_assistants_1_1_event_handler.html#acf640b9993efe169d237d0e2d180bbb0">Assistants.EventHandler.on_text_done</a></div><div class="ttdeci">on_text_done(self, text)</div><div class="ttdef"><b>Definition</b> <a href="#l00097">Assistants.py:97</a></div></div>
<div class="ttc" id="aclass_assistants_1_1_event_handler_html_adbc2ebd7e16dbd2e6948507d5f09485e"><div class="ttname"><a href="class_assistants_1_1_event_handler.html#adbc2ebd7e16dbd2e6948507d5f09485e">Assistants.EventHandler.on_tool_call_done</a></div><div class="ttdeci">on_tool_call_done(self, tool_call)</div><div class="ttdef"><b>Definition</b> <a href="#l00122">Assistants.py:122</a></div></div>
<div class="ttc" id="aclass_assistants_1_1_event_handler_html_ae91962de43c8526db76f5da35baaf237"><div class="ttname"><a href="class_assistants_1_1_event_handler.html#ae91962de43c8526db76f5da35baaf237">Assistants.EventHandler.on_event</a></div><div class="ttdeci">on_event(self, event)</div><div class="ttdef"><b>Definition</b> <a href="#l00077">Assistants.py:77</a></div></div>
<div class="ttc" id="aclass_assistants_1_1_event_handler_html_af45ca7cb36b12473ed39b4fb4e5c4b4f"><div class="ttname"><a href="class_assistants_1_1_event_handler.html#af45ca7cb36b12473ed39b4fb4e5c4b4f">Assistants.EventHandler.create_file_link</a></div><div class="ttdeci">create_file_link(self, file_name, file_id)</div><div class="ttdef"><b>Definition</b> <a href="#l00184">Assistants.py:184</a></div></div>
<div class="ttc" id="anamespace_assistants_html_a0a5d3f62216b341f7d7cc8895f486cbe"><div class="ttname"><a href="namespace_assistants.html#a0a5d3f62216b341f7d7cc8895f486cbe">Assistants.create_message</a></div><div class="ttdeci">create_message(thread, content, file)</div><div class="ttdef"><b>Definition</b> <a href="#l00203">Assistants.py:203</a></div></div>
<div class="ttc" id="anamespace_assistants_html_a3df180ad7a5b59c360c5e04c460169c1"><div class="ttname"><a href="namespace_assistants.html#a3df180ad7a5b59c360c5e04c460169c1">Assistants.str_to_bool</a></div><div class="ttdeci">str_to_bool(str_input)</div><div class="ttdef"><b>Definition</b> <a href="#l00012">Assistants.py:12</a></div></div>
<div class="ttc" id="anamespace_assistants_html_a7e06d04d97c10c38236400d7bb3f7c15"><div class="ttname"><a href="namespace_assistants.html#a7e06d04d97c10c38236400d7bb3f7c15">Assistants.run_stream</a></div><div class="ttdeci">run_stream(user_input, file, selected_assistant_id)</div><div class="ttdef"><b>Definition</b> <a href="#l00222">Assistants.py:222</a></div></div>
<div class="ttc" id="anamespace_assistants_html_abb2e1b5dbeb417a174f49b522a1b1e99"><div class="ttname"><a href="namespace_assistants.html#abb2e1b5dbeb417a174f49b522a1b1e99">Assistants.main</a></div><div class="ttdeci">main()</div><div class="ttdef"><b>Definition</b> <a href="#l00248">Assistants.py:248</a></div></div>
<div class="ttc" id="anamespace_assistants_html_aff202743350df09a7bde370deb710c29"><div class="ttname"><a href="namespace_assistants.html#aff202743350df09a7bde370deb710c29">Assistants.create_thread</a></div><div class="ttdeci">create_thread(content, file)</div><div class="ttdef"><b>Definition</b> <a href="#l00192">Assistants.py:192</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_e25d3a482582c6fca6ce4e463392b362.html">GPTPhone (2)</a></li><li class="navelem"><a class="el" href="_assistants_8py.html">Assistants.py</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
