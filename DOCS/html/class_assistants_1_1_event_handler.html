<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>GPTPHONE: EventHandler Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">GPTPHONE
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('class_assistants_1_1_event_handler.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Data Fields</a>  </div>
  <div class="headertitle"><div class="title">EventHandler Class Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Inheritance diagram for EventHandler:</div>
<div class="dyncontent">
<div class="center"><img src="class_assistants_1_1_event_handler__inherit__graph.png" border="0" usemap="#a_event_handler_inherit__map" alt="Inheritance graph"/></div>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for EventHandler:</div>
<div class="dyncontent">
<div class="center"><img src="class_assistants_1_1_event_handler__coll__graph.png" border="0" usemap="#a_event_handler_coll__map" alt="Collaboration graph"/></div>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:abdd362d5f799ad16b5d6700efe590290" id="r_abdd362d5f799ad16b5d6700efe590290"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abdd362d5f799ad16b5d6700efe590290">__init__</a> (self)</td></tr>
<tr class="separator:abdd362d5f799ad16b5d6700efe590290"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff0cd190f2fae5b016d4faf3c1c8e073" id="r_aff0cd190f2fae5b016d4faf3c1c8e073"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aff0cd190f2fae5b016d4faf3c1c8e073">on_event</a> (self, event)</td></tr>
<tr class="separator:aff0cd190f2fae5b016d4faf3c1c8e073"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae941d8bdb10c17fe7bca834a1f24038a" id="r_ae941d8bdb10c17fe7bca834a1f24038a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae941d8bdb10c17fe7bca834a1f24038a">on_text_created</a> (self, text)</td></tr>
<tr class="separator:ae941d8bdb10c17fe7bca834a1f24038a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8cb3855bd5daa733879e2626db9ad227" id="r_a8cb3855bd5daa733879e2626db9ad227"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8cb3855bd5daa733879e2626db9ad227">on_text_delta</a> (self, delta, snapshot)</td></tr>
<tr class="separator:a8cb3855bd5daa733879e2626db9ad227"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4402d96c3f2f5a5c2a53aebbf7b343d" id="r_ad4402d96c3f2f5a5c2a53aebbf7b343d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad4402d96c3f2f5a5c2a53aebbf7b343d">on_text_done</a> (self, text)</td></tr>
<tr class="separator:ad4402d96c3f2f5a5c2a53aebbf7b343d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a388bc733a67fc1ac664c79116b82a2c4" id="r_a388bc733a67fc1ac664c79116b82a2c4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a388bc733a67fc1ac664c79116b82a2c4">on_tool_call_created</a> (self, tool_call)</td></tr>
<tr class="separator:a388bc733a67fc1ac664c79116b82a2c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a12334a2e56f9b3c7be63a4128e71aeaa" id="r_a12334a2e56f9b3c7be63a4128e71aeaa"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a12334a2e56f9b3c7be63a4128e71aeaa">on_tool_call_delta</a> (self, delta, snapshot)</td></tr>
<tr class="separator:a12334a2e56f9b3c7be63a4128e71aeaa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aae25b48c0a1a615b819caf177dd00a94" id="r_aae25b48c0a1a615b819caf177dd00a94"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aae25b48c0a1a615b819caf177dd00a94">on_tool_call_done</a> (self, tool_call)</td></tr>
<tr class="separator:aae25b48c0a1a615b819caf177dd00a94"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae227e8e35e232ac8cb29763bdfcdb4ee" id="r_ae227e8e35e232ac8cb29763bdfcdb4ee"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ae227e8e35e232ac8cb29763bdfcdb4ee">format_annotation</a> (self, text)</td></tr>
<tr class="separator:ae227e8e35e232ac8cb29763bdfcdb4ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6092c613dbaf790707f8cd30fbc54744" id="r_a6092c613dbaf790707f8cd30fbc54744"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6092c613dbaf790707f8cd30fbc54744">create_file_link</a> (self, file_name, file_id)</td></tr>
<tr class="separator:a6092c613dbaf790707f8cd30fbc54744"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-attribs" name="pub-attribs"></a>
Data Fields</h2></td></tr>
<tr class="memitem:a58320a108df6e2b18701bb903c9666cb" id="r_a58320a108df6e2b18701bb903c9666cb"><td class="memItemLeft" align="right" valign="top">dict&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a58320a108df6e2b18701bb903c9666cb">session_state</a></td></tr>
<tr class="separator:a58320a108df6e2b18701bb903c9666cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><pre class="fragment">Class EventHandler

This class is a subclass of the openai.AssistantEventHandler class and contains various methods that handle different events related to the OpenAI Assistant.

Attributes:
- session_state (dict): A dictionary that stores the current state of the session, including chat log, tool calls, current message, current markdown, current tool input, and current tool input markdown.

Methods:
- on_event(event): Handles the general event. This method is not implemented in the EventHandler class and needs to be overridden in a subclass.
- on_text_created(text): Handles the event when a new text is created. It sets the current message to empty and prints "Assistant:".
- on_text_delta(delta, snapshot): Handles the event when a delta change is made to the text. It updates the current message in the session state and prints the updated text.
- on_text_done(text): Handles the event when the text is complete. It formats the annotation in the text, prints the formatted text, and appends it to the chat log in the session state.
- on_tool_call_created(tool_call): Handles the event when a tool call is created. If the tool call is of type "code_interpreter", it sets the current tool input to empty and prints "Assistant:".
- on_tool_call_delta(delta, snapshot): Handles the event when a delta change is made to the tool call. If the delta is of type "code_interpreter", it updates the current tool input in the session state and prints the input code.
- on_tool_call_done(tool_call): Handles the event when the tool call is complete. It appends the tool call to the tool calls list in the session state. If the tool call is of type "code_interpreter", it prints the input code and outputs.
- format_annotation(text): Formats the annotation in the given text by replacing annotation texts with numbered references and creating download links for file citations. Returns the formatted text.
- create_file_link(file_name, file_id): Creates a download link for the given file name and file ID. Returns the link tag.

Note: This class needs to be subclassed and the on_event() method needs to be implemented in the subclass.</pre> </div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="abdd362d5f799ad16b5d6700efe590290" name="abdd362d5f799ad16b5d6700efe590290"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abdd362d5f799ad16b5d6700efe590290">&#9670;&#160;</a></span>__init__()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__init__ </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   64</span>    <span class="keyword">def </span>__init__(self):</div>
<div class="line"><span class="lineno">   65</span> </div>
<div class="line"><span class="lineno">   66</span>        super().__init__()</div>
<div class="line"><span class="lineno">   67</span>        self.session_state = {</div>
<div class="line"><span class="lineno">   68</span>            <span class="stringliteral">&quot;chat_log&quot;</span>: [],</div>
<div class="line"><span class="lineno">   69</span>            <span class="stringliteral">&quot;tool_calls&quot;</span>: [],</div>
<div class="line"><span class="lineno">   70</span>            <span class="stringliteral">&quot;current_message&quot;</span>: <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">   71</span>            <span class="stringliteral">&quot;current_markdown&quot;</span>: <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">   72</span>            <span class="stringliteral">&quot;current_tool_input&quot;</span>: <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><span class="lineno">   73</span>            <span class="stringliteral">&quot;current_tool_input_markdown&quot;</span>: <span class="stringliteral">&quot;&quot;</span></div>
<div class="line"><span class="lineno">   74</span>        }</div>
<div class="line"><span class="lineno">   75</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l00064">EventHandler.__init__()</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l00064">EventHandler.__init__()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_assistants_1_1_event_handler_abdd362d5f799ad16b5d6700efe590290_cgraph.png" border="0" usemap="#aclass_assistants_1_1_event_handler_abdd362d5f799ad16b5d6700efe590290_cgraph" alt=""/></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_assistants_1_1_event_handler_abdd362d5f799ad16b5d6700efe590290_icgraph.png" border="0" usemap="#aclass_assistants_1_1_event_handler_abdd362d5f799ad16b5d6700efe590290_icgraph" alt=""/></div>
</div>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a6092c613dbaf790707f8cd30fbc54744" name="a6092c613dbaf790707f8cd30fbc54744"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6092c613dbaf790707f8cd30fbc54744">&#9670;&#160;</a></span>create_file_link()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">create_file_link </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>file_name</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>file_id</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  184</span>    <span class="keyword">def </span>create_file_link(self, file_name, file_id):</div>
<div class="line"><span class="lineno">  185</span>        content = client.files.content(file_id)</div>
<div class="line"><span class="lineno">  186</span>        content_type = content.response.headers[<span class="stringliteral">&quot;content-type&quot;</span>]</div>
<div class="line"><span class="lineno">  187</span>        b64 = base64.b64encode(content.text.encode(content.encoding)).decode()</div>
<div class="line"><span class="lineno">  188</span>        link_tag = f<span class="stringliteral">&#39;&lt;a href=&quot;data:{content_type};base64,{b64}&quot; download=&quot;{file_name}&quot;&gt;Download Link&lt;/a&gt;&#39;</span></div>
<div class="line"><span class="lineno">  189</span>        <span class="keywordflow">return</span> link_tag</div>
<div class="line"><span class="lineno">  190</span> </div>
<div class="line"><span class="lineno">  191</span><span class="preprocessor">@log_function_call</span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="#l00164">EventHandler.format_annotation()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_assistants_1_1_event_handler_a6092c613dbaf790707f8cd30fbc54744_icgraph.png" border="0" usemap="#aclass_assistants_1_1_event_handler_a6092c613dbaf790707f8cd30fbc54744_icgraph" alt=""/></div>
</div>

</div>
</div>
<a id="ae227e8e35e232ac8cb29763bdfcdb4ee" name="ae227e8e35e232ac8cb29763bdfcdb4ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae227e8e35e232ac8cb29763bdfcdb4ee">&#9670;&#160;</a></span>format_annotation()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">format_annotation </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>text</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  164</span>    <span class="keyword">def </span>format_annotation(self, text):</div>
<div class="line"><span class="lineno">  165</span>        citations = []</div>
<div class="line"><span class="lineno">  166</span>        text_value = text.value</div>
<div class="line"><span class="lineno">  167</span>        <span class="keywordflow">for</span> index, annotation <span class="keywordflow">in</span> enumerate(text.annotations):</div>
<div class="line"><span class="lineno">  168</span>            text_value = text_value.replace(annotation.text, f<span class="stringliteral">&quot; [{index}]&quot;</span>)</div>
<div class="line"><span class="lineno">  169</span> </div>
<div class="line"><span class="lineno">  170</span>            <span class="keywordflow">if</span> file_citation := getattr(annotation, <span class="stringliteral">&quot;file_citation&quot;</span>, <span class="keywordtype">None</span>):</div>
<div class="line"><span class="lineno">  171</span>                cited_file = client.files.retrieve(file_citation.file_id)</div>
<div class="line"><span class="lineno">  172</span>                citations.append(</div>
<div class="line"><span class="lineno">  173</span>                    f<span class="stringliteral">&quot;[{index}] {file_citation.quote} from {cited_file.filename}&quot;</span></div>
<div class="line"><span class="lineno">  174</span>                )</div>
<div class="line"><span class="lineno">  175</span>            <span class="keywordflow">elif</span> file_path := getattr(annotation, <span class="stringliteral">&quot;file_path&quot;</span>, <span class="keywordtype">None</span>):</div>
<div class="line"><span class="lineno">  176</span>                link_tag = self.create_file_link(</div>
<div class="line"><span class="lineno">  177</span>                    annotation.text.split(<span class="stringliteral">&quot;/&quot;</span>)[-1],</div>
<div class="line"><span class="lineno">  178</span>                    file_path.file_id,</div>
<div class="line"><span class="lineno">  179</span>                )</div>
<div class="line"><span class="lineno">  180</span>                text_value = re.sub(<span class="stringliteral">r&quot;\[(.*?)\]\s*\&zwj;(\s*(.*?)\s*\&zwj;)&quot;</span>, link_tag, text_value)</div>
<div class="line"><span class="lineno">  181</span>        text_value += <span class="stringliteral">&quot;\n\n&quot;</span> + <span class="stringliteral">&quot;\n&quot;</span>.join(citations)</div>
<div class="line"><span class="lineno">  182</span>        <span class="keywordflow">return</span> text_value</div>
<div class="line"><span class="lineno">  183</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l00184">EventHandler.create_file_link()</a>.</p>

<p class="reference">Referenced by <a class="el" href="#l00097">EventHandler.on_text_done()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_assistants_1_1_event_handler_ae227e8e35e232ac8cb29763bdfcdb4ee_cgraph.png" border="0" usemap="#aclass_assistants_1_1_event_handler_ae227e8e35e232ac8cb29763bdfcdb4ee_cgraph" alt=""/></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_assistants_1_1_event_handler_ae227e8e35e232ac8cb29763bdfcdb4ee_icgraph.png" border="0" usemap="#aclass_assistants_1_1_event_handler_ae227e8e35e232ac8cb29763bdfcdb4ee_icgraph" alt=""/></div>
</div>

</div>
</div>
<a id="aff0cd190f2fae5b016d4faf3c1c8e073" name="aff0cd190f2fae5b016d4faf3c1c8e073"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aff0cd190f2fae5b016d4faf3c1c8e073">&#9670;&#160;</a></span>on_event()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">on_event </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>event</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   77</span>    <span class="keyword">def </span>on_event(self, event):</div>
<div class="line"><span class="lineno">   78</span>        <span class="keywordflow">pass</span></div>
<div class="line"><span class="lineno">   79</span> </div>
</div><!-- fragment -->
</div>
</div>
<a id="ae941d8bdb10c17fe7bca834a1f24038a" name="ae941d8bdb10c17fe7bca834a1f24038a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae941d8bdb10c17fe7bca834a1f24038a">&#9670;&#160;</a></span>on_text_created()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">on_text_created </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>text</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   82</span>    <span class="keyword">def </span>on_text_created(self, text):</div>
<div class="line"><span class="lineno">   83</span>        self.session_state[<span class="stringliteral">&quot;current_message&quot;</span>] = <span class="stringliteral">&quot;&quot;</span></div>
<div class="line"><span class="lineno">   84</span>        print(<span class="stringliteral">&quot;Assistant:&quot;</span>)</div>
<div class="line"><span class="lineno">   85</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l00067">EventHandler.session_state</a>.</p>

</div>
</div>
<a id="a8cb3855bd5daa733879e2626db9ad227" name="a8cb3855bd5daa733879e2626db9ad227"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8cb3855bd5daa733879e2626db9ad227">&#9670;&#160;</a></span>on_text_delta()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">on_text_delta </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>delta</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>snapshot</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   88</span>    <span class="keyword">def </span>on_text_delta(self, delta, snapshot):</div>
<div class="line"><span class="lineno">   89</span>        <span class="keywordflow">if</span> snapshot.value:</div>
<div class="line"><span class="lineno">   90</span>            text_value = re.sub(</div>
<div class="line"><span class="lineno">   91</span>                <span class="stringliteral">r&quot;\[(.*?)\]\s*\&zwj;(\s*(.*?)\s*\&zwj;)&quot;</span>, <span class="stringliteral">&quot;Download Link&quot;</span>, snapshot.value</div>
<div class="line"><span class="lineno">   92</span>            )</div>
<div class="line"><span class="lineno">   93</span>            self.session_state[<span class="stringliteral">&quot;current_message&quot;</span>] = text_value</div>
<div class="line"><span class="lineno">   94</span>            print(text_value, end=<span class="stringliteral">&quot;&quot;</span>, flush=<span class="keyword">True</span>)</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l00067">EventHandler.session_state</a>.</p>

</div>
</div>
<a id="ad4402d96c3f2f5a5c2a53aebbf7b343d" name="ad4402d96c3f2f5a5c2a53aebbf7b343d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad4402d96c3f2f5a5c2a53aebbf7b343d">&#9670;&#160;</a></span>on_text_done()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">on_text_done </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>text</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   97</span>    <span class="keyword">def </span>on_text_done(self, text):</div>
<div class="line"><span class="lineno">   98</span>        format_text = self.format_annotation(text)</div>
<div class="line"><span class="lineno">   99</span>        print(<span class="stringliteral">&quot;\n&quot;</span> + format_text)</div>
<div class="line"><span class="lineno">  100</span>        self.session_state[<span class="stringliteral">&quot;chat_log&quot;</span>].append({<span class="stringliteral">&quot;name&quot;</span>: <span class="stringliteral">&quot;assistant&quot;</span>, <span class="stringliteral">&quot;msg&quot;</span>: format_text})</div>
<div class="line"><span class="lineno">  101</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l00164">EventHandler.format_annotation()</a>, and <a class="el" href="#l00067">EventHandler.session_state</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="class_assistants_1_1_event_handler_ad4402d96c3f2f5a5c2a53aebbf7b343d_cgraph.png" border="0" usemap="#aclass_assistants_1_1_event_handler_ad4402d96c3f2f5a5c2a53aebbf7b343d_cgraph" alt=""/></div>
</div>

</div>
</div>
<a id="a388bc733a67fc1ac664c79116b82a2c4" name="a388bc733a67fc1ac664c79116b82a2c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a388bc733a67fc1ac664c79116b82a2c4">&#9670;&#160;</a></span>on_tool_call_created()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">on_tool_call_created </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>tool_call</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  103</span>    <span class="keyword">def </span>on_tool_call_created(self, tool_call):</div>
<div class="line"><span class="lineno">  104</span>        <span class="keywordflow">if</span> tool_call.type == <span class="stringliteral">&quot;code_interpreter&quot;</span>:</div>
<div class="line"><span class="lineno">  105</span>            self.session_state[<span class="stringliteral">&quot;current_tool_input&quot;</span>] = <span class="stringliteral">&quot;&quot;</span></div>
<div class="line"><span class="lineno">  106</span>            print(<span class="stringliteral">&quot;Assistant:&quot;</span>)</div>
<div class="line"><span class="lineno">  107</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l00067">EventHandler.session_state</a>.</p>

</div>
</div>
<a id="a12334a2e56f9b3c7be63a4128e71aeaa" name="a12334a2e56f9b3c7be63a4128e71aeaa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a12334a2e56f9b3c7be63a4128e71aeaa">&#9670;&#160;</a></span>on_tool_call_delta()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">on_tool_call_delta </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>delta</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>snapshot</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  109</span>    <span class="keyword">def </span>on_tool_call_delta(self, delta, snapshot):</div>
<div class="line"><span class="lineno">  110</span>        <span class="keywordflow">if</span> delta.type == <span class="stringliteral">&quot;code_interpreter&quot;</span>:</div>
<div class="line"><span class="lineno">  111</span>            <span class="keywordflow">if</span> delta.code_interpreter.input:</div>
<div class="line"><span class="lineno">  112</span>                self.session_state[<span class="stringliteral">&quot;current_tool_input&quot;</span>] += delta.code_interpreter.input</div>
<div class="line"><span class="lineno">  113</span>                input_code = f<span class="stringliteral">&quot;### code interpreter\ninput:\n```python\n{self.session_state[&#39;current_tool_input&#39;]}\n```&quot;</span></div>
<div class="line"><span class="lineno">  114</span>                print(input_code, end=<span class="stringliteral">&quot;&quot;</span>, flush=<span class="keyword">True</span>)</div>
<div class="line"><span class="lineno">  115</span> </div>
<div class="line"><span class="lineno">  116</span>            <span class="keywordflow">if</span> delta.code_interpreter.outputs:</div>
<div class="line"><span class="lineno">  117</span>                <span class="keywordflow">for</span> output <span class="keywordflow">in</span> delta.code_interpreter.outputs:</div>
<div class="line"><span class="lineno">  118</span>                    <span class="keywordflow">if</span> output.type == <span class="stringliteral">&quot;logs&quot;</span>:</div>
<div class="line"><span class="lineno">  119</span>                        <span class="keywordflow">pass</span></div>
<div class="line"><span class="lineno">  120</span> </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l00067">EventHandler.session_state</a>.</p>

</div>
</div>
<a id="aae25b48c0a1a615b819caf177dd00a94" name="aae25b48c0a1a615b819caf177dd00a94"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aae25b48c0a1a615b819caf177dd00a94">&#9670;&#160;</a></span>on_tool_call_done()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">on_tool_call_done </td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>self</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname"><em>tool_call</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">  122</span>    <span class="keyword">def </span>on_tool_call_done(self, tool_call):</div>
<div class="line"><span class="lineno">  123</span>        self.session_state[<span class="stringliteral">&quot;tool_calls&quot;</span>].append(tool_call)</div>
<div class="line"><span class="lineno">  124</span>        <span class="keywordflow">if</span> tool_call.type == <span class="stringliteral">&quot;code_interpreter&quot;</span>:</div>
<div class="line"><span class="lineno">  125</span>            input_code = f<span class="stringliteral">&quot;### code interpreter\ninput:\n```python\n{tool_call.code_interpreter.input}\n```&quot;</span></div>
<div class="line"><span class="lineno">  126</span>            print(input_code)</div>
<div class="line"><span class="lineno">  127</span>            <span class="keywordflow">for</span> output <span class="keywordflow">in</span> tool_call.code_interpreter.outputs:</div>
<div class="line"><span class="lineno">  128</span>                <span class="keywordflow">if</span> output.type == <span class="stringliteral">&quot;logs&quot;</span>:</div>
<div class="line"><span class="lineno">  129</span>                    output = f<span class="stringliteral">&quot;### code interpreter\noutput:\n```\n{output.logs}\n```&quot;</span></div>
<div class="line"><span class="lineno">  130</span>                    print(output)</div>
<div class="line"><span class="lineno">  131</span> </div>
<div class="line"><span class="lineno">  132</span>        <span class="keywordflow">elif</span> (</div>
<div class="line"><span class="lineno">  133</span>                tool_call.type == <span class="stringliteral">&quot;function&quot;</span></div>
<div class="line"><span class="lineno">  134</span>                <span class="keywordflow">and</span> self.current_run.status == <span class="stringliteral">&quot;requires_action&quot;</span></div>
<div class="line"><span class="lineno">  135</span>        ):</div>
<div class="line"><span class="lineno">  136</span>            msg = f<span class="stringliteral">&quot;### Function Calling: {tool_call.function.name}&quot;</span></div>
<div class="line"><span class="lineno">  137</span>            print(msg)</div>
<div class="line"><span class="lineno">  138</span>            self.session_state[<span class="stringliteral">&quot;chat_log&quot;</span>].append({<span class="stringliteral">&quot;name&quot;</span>: <span class="stringliteral">&quot;assistant&quot;</span>, <span class="stringliteral">&quot;msg&quot;</span>: msg})</div>
<div class="line"><span class="lineno">  139</span>            tool_calls = self.current_run.required_action.submit_tool_outputs.tool_calls</div>
<div class="line"><span class="lineno">  140</span>            tool_outputs = []</div>
<div class="line"><span class="lineno">  141</span>            <span class="keywordflow">for</span> submit_tool_call <span class="keywordflow">in</span> tool_calls:</div>
<div class="line"><span class="lineno">  142</span>                tool_function_name = submit_tool_call.function.name</div>
<div class="line"><span class="lineno">  143</span>                tool_function_arguments = json.loads(</div>
<div class="line"><span class="lineno">  144</span>                    submit_tool_call.function.arguments</div>
<div class="line"><span class="lineno">  145</span>                )</div>
<div class="line"><span class="lineno">  146</span>                tool_function_output = TOOL_MAP[tool_function_name](</div>
<div class="line"><span class="lineno">  147</span>                    **tool_function_arguments</div>
<div class="line"><span class="lineno">  148</span>                )</div>
<div class="line"><span class="lineno">  149</span>                tool_outputs.append(</div>
<div class="line"><span class="lineno">  150</span>                    {</div>
<div class="line"><span class="lineno">  151</span>                        <span class="stringliteral">&quot;tool_call_id&quot;</span>: submit_tool_call.id,</div>
<div class="line"><span class="lineno">  152</span>                        <span class="stringliteral">&quot;output&quot;</span>: tool_function_output,</div>
<div class="line"><span class="lineno">  153</span>                    }</div>
<div class="line"><span class="lineno">  154</span>                )</div>
<div class="line"><span class="lineno">  155</span> </div>
<div class="line"><span class="lineno">  156</span>            <span class="keyword">with</span> client.beta.threads.runs.submit_tool_outputs_stream(</div>
<div class="line"><span class="lineno">  157</span>                    thread_id=thread.id,</div>
<div class="line"><span class="lineno">  158</span>                    run_id=self.current_run.id,</div>
<div class="line"><span class="lineno">  159</span>                    tool_outputs=tool_outputs,</div>
<div class="line"><span class="lineno">  160</span>                    event_handler=EventHandler(),</div>
<div class="line"><span class="lineno">  161</span>            ) <span class="keyword">as</span> stream:</div>
<div class="line"><span class="lineno">  162</span>                stream.until_done()</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="#l00067">EventHandler.session_state</a>.</p>

</div>
</div>
<h2 class="groupheader">Field Documentation</h2>
<a id="a58320a108df6e2b18701bb903c9666cb" name="a58320a108df6e2b18701bb903c9666cb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a58320a108df6e2b18701bb903c9666cb">&#9670;&#160;</a></span>session_state</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">dict session_state</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">=  {</div>
<div class="line">            <span class="stringliteral">&quot;chat_log&quot;</span>: [],</div>
<div class="line">            <span class="stringliteral">&quot;tool_calls&quot;</span>: [],</div>
<div class="line">            <span class="stringliteral">&quot;current_message&quot;</span>: <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">            <span class="stringliteral">&quot;current_markdown&quot;</span>: <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">            <span class="stringliteral">&quot;current_tool_input&quot;</span>: <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line">            <span class="stringliteral">&quot;current_tool_input_markdown&quot;</span>: <span class="stringliteral">&quot;&quot;</span></div>
<div class="line">        }</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="#l00082">EventHandler.on_text_created()</a>, <a class="el" href="#l00088">EventHandler.on_text_delta()</a>, <a class="el" href="#l00097">EventHandler.on_text_done()</a>, <a class="el" href="#l00103">EventHandler.on_tool_call_created()</a>, <a class="el" href="#l00109">EventHandler.on_tool_call_delta()</a>, and <a class="el" href="#l00122">EventHandler.on_tool_call_done()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>/Users/seanbaker/Downloads/GPTPhone (2)/<a class="el" href="">Assistants.py</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespace_assistants.html">Assistants</a></li><li class="navelem"><a class="el" href="class_assistants_1_1_event_handler.html">EventHandler</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
